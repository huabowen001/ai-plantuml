'use strict';var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.createTemplateTagFirstArg=function(a){return a.raw=a};$jscomp.createTemplateTagFirstArgWithRaw=function(a,b){a.raw=b;return a};$jscomp.arrayIteratorImpl=function(a){var b=0;return function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}}};$jscomp.arrayIterator=function(a){return{next:$jscomp.arrayIteratorImpl(a)}};
$jscomp.makeIterator=function(a){var b="undefined"!=typeof Symbol&&Symbol.iterator&&a[Symbol.iterator];if(b)return b.call(a);if("number"==typeof a.length)return $jscomp.arrayIterator(a);throw Error(String(a)+" is not an iterable or ArrayLike");};$jscomp.arrayFromIterator=function(a){for(var b,c=[];!(b=a.next()).done;)c.push(b.value);return c};$jscomp.arrayFromIterable=function(a){return a instanceof Array?a:$jscomp.arrayFromIterator($jscomp.makeIterator(a))};
$jscomp.owns=function(a,b){return Object.prototype.hasOwnProperty.call(a,b)};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.ISOLATE_POLYFILLS=!1;$jscomp.FORCE_POLYFILL_PROMISE=!1;$jscomp.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){if(a==Array.prototype||a==Object.prototype)return a;a[b]=c.value;return a};$jscomp.getGlobal=function(a){a=["object"==typeof globalThis&&globalThis,a,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var b=0;b<a.length;++b){var c=a[b];if(c&&c.Math==Math)return c}throw Error("Cannot find global object");};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.IS_SYMBOL_NATIVE="function"===typeof Symbol&&"symbol"===typeof Symbol("x");$jscomp.TRUST_ES6_POLYFILLS=!$jscomp.ISOLATE_POLYFILLS||$jscomp.IS_SYMBOL_NATIVE;$jscomp.polyfills={};$jscomp.propertyToPolyfillSymbol={};$jscomp.POLYFILL_PREFIX="$jscp$";var $jscomp$lookupPolyfilledValue=function(a,b,c){if(!c||null!=a){c=$jscomp.propertyToPolyfillSymbol[b];if(null==c)return a[b];c=a[c];return void 0!==c?c:a[b]}};
$jscomp.polyfill=function(a,b,c,e){b&&($jscomp.ISOLATE_POLYFILLS?$jscomp.polyfillIsolated(a,b,c,e):$jscomp.polyfillUnisolated(a,b,c,e))};$jscomp.polyfillUnisolated=function(a,b,c,e){c=$jscomp.global;a=a.split(".");for(e=0;e<a.length-1;e++){var d=a[e];if(!(d in c))return;c=c[d]}a=a[a.length-1];e=c[a];b=b(e);b!=e&&null!=b&&$jscomp.defineProperty(c,a,{configurable:!0,writable:!0,value:b})};
$jscomp.polyfillIsolated=function(a,b,c,e){var d=a.split(".");a=1===d.length;e=d[0];e=!a&&e in $jscomp.polyfills?$jscomp.polyfills:$jscomp.global;for(var f=0;f<d.length-1;f++){var g=d[f];if(!(g in e))return;e=e[g]}d=d[d.length-1];c=$jscomp.IS_SYMBOL_NATIVE&&"es6"===c?e[d]:null;b=b(c);null!=b&&(a?$jscomp.defineProperty($jscomp.polyfills,d,{configurable:!0,writable:!0,value:b}):b!==c&&(void 0===$jscomp.propertyToPolyfillSymbol[d]&&(c=1E9*Math.random()>>>0,$jscomp.propertyToPolyfillSymbol[d]=$jscomp.IS_SYMBOL_NATIVE?
$jscomp.global.Symbol(d):$jscomp.POLYFILL_PREFIX+c+"$"+d),$jscomp.defineProperty(e,$jscomp.propertyToPolyfillSymbol[d],{configurable:!0,writable:!0,value:b})))};$jscomp.assign=$jscomp.TRUST_ES6_POLYFILLS&&"function"==typeof Object.assign?Object.assign:function(a,b){for(var c=1;c<arguments.length;c++){var e=arguments[c];if(e)for(var d in e)$jscomp.owns(e,d)&&(a[d]=e[d])}return a};$jscomp.polyfill("Object.assign",function(a){return a||$jscomp.assign},"es6","es3");
$jscomp.underscoreProtoCanBeSet=function(){var a={a:!0},b={};try{return b.__proto__=a,b.a}catch(c){}return!1};$jscomp.setPrototypeOf=$jscomp.TRUST_ES6_POLYFILLS&&"function"==typeof Object.setPrototypeOf?Object.setPrototypeOf:$jscomp.underscoreProtoCanBeSet()?function(a,b){a.__proto__=b;if(a.__proto__!==b)throw new TypeError(a+" is not extensible");return a}:null;$jscomp.generator={};
$jscomp.generator.ensureIteratorResultIsObject_=function(a){if(!(a instanceof Object))throw new TypeError("Iterator result "+a+" is not an object");};$jscomp.generator.Context=function(){this.isRunning_=!1;this.yieldAllIterator_=null;this.yieldResult=void 0;this.nextAddress=1;this.finallyAddress_=this.catchAddress_=0;this.finallyContexts_=this.abruptCompletion_=null};
$jscomp.generator.Context.prototype.start_=function(){if(this.isRunning_)throw new TypeError("Generator is already running");this.isRunning_=!0};$jscomp.generator.Context.prototype.stop_=function(){this.isRunning_=!1};$jscomp.generator.Context.prototype.jumpToErrorHandler_=function(){this.nextAddress=this.catchAddress_||this.finallyAddress_};$jscomp.generator.Context.prototype.next_=function(a){this.yieldResult=a};
$jscomp.generator.Context.prototype.throw_=function(a){this.abruptCompletion_={exception:a,isException:!0};this.jumpToErrorHandler_()};$jscomp.generator.Context.prototype.return=function(a){this.abruptCompletion_={return:a};this.nextAddress=this.finallyAddress_};$jscomp.generator.Context.prototype.jumpThroughFinallyBlocks=function(a){this.abruptCompletion_={jumpTo:a};this.nextAddress=this.finallyAddress_};$jscomp.generator.Context.prototype.yield=function(a,b){this.nextAddress=b;return{value:a}};
$jscomp.generator.Context.prototype.yieldAll=function(a,b){a=$jscomp.makeIterator(a);var c=a.next();$jscomp.generator.ensureIteratorResultIsObject_(c);if(c.done)this.yieldResult=c.value,this.nextAddress=b;else return this.yieldAllIterator_=a,this.yield(c.value,b)};$jscomp.generator.Context.prototype.jumpTo=function(a){this.nextAddress=a};$jscomp.generator.Context.prototype.jumpToEnd=function(){this.nextAddress=0};
$jscomp.generator.Context.prototype.setCatchFinallyBlocks=function(a,b){this.catchAddress_=a;void 0!=b&&(this.finallyAddress_=b)};$jscomp.generator.Context.prototype.setFinallyBlock=function(a){this.catchAddress_=0;this.finallyAddress_=a||0};$jscomp.generator.Context.prototype.leaveTryBlock=function(a,b){this.nextAddress=a;this.catchAddress_=b||0};
$jscomp.generator.Context.prototype.enterCatchBlock=function(a){this.catchAddress_=a||0;a=this.abruptCompletion_.exception;this.abruptCompletion_=null;return a};$jscomp.generator.Context.prototype.enterFinallyBlock=function(a,b,c){c?this.finallyContexts_[c]=this.abruptCompletion_:this.finallyContexts_=[this.abruptCompletion_];this.catchAddress_=a||0;this.finallyAddress_=b||0};
$jscomp.generator.Context.prototype.leaveFinallyBlock=function(a,b){b=this.finallyContexts_.splice(b||0)[0];if(b=this.abruptCompletion_=this.abruptCompletion_||b){if(b.isException)return this.jumpToErrorHandler_();void 0!=b.jumpTo&&this.finallyAddress_<b.jumpTo?(this.nextAddress=b.jumpTo,this.abruptCompletion_=null):this.nextAddress=this.finallyAddress_}else this.nextAddress=a};$jscomp.generator.Context.prototype.forIn=function(a){return new $jscomp.generator.Context.PropertyIterator(a)};
$jscomp.generator.Context.PropertyIterator=function(a){this.object_=a;this.properties_=[];for(var b in a)this.properties_.push(b);this.properties_.reverse()};$jscomp.generator.Context.PropertyIterator.prototype.getNext=function(){for(;0<this.properties_.length;){var a=this.properties_.pop();if(a in this.object_)return a}return null};$jscomp.generator.Engine_=function(a){this.context_=new $jscomp.generator.Context;this.program_=a};
$jscomp.generator.Engine_.prototype.next_=function(a){this.context_.start_();if(this.context_.yieldAllIterator_)return this.yieldAllStep_(this.context_.yieldAllIterator_.next,a,this.context_.next_);this.context_.next_(a);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.return_=function(a){this.context_.start_();var b=this.context_.yieldAllIterator_;if(b)return this.yieldAllStep_("return"in b?b["return"]:function(c){return{value:c,done:!0}},a,this.context_.return);this.context_.return(a);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.throw_=function(a){this.context_.start_();if(this.context_.yieldAllIterator_)return this.yieldAllStep_(this.context_.yieldAllIterator_["throw"],a,this.context_.next_);this.context_.throw_(a);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.yieldAllStep_=function(a,b,c){try{var e=a.call(this.context_.yieldAllIterator_,b);$jscomp.generator.ensureIteratorResultIsObject_(e);if(!e.done)return this.context_.stop_(),e;var d=e.value}catch(f){return this.context_.yieldAllIterator_=null,this.context_.throw_(f),this.nextStep_()}this.context_.yieldAllIterator_=null;c.call(this.context_,d);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.nextStep_=function(){for(;this.context_.nextAddress;)try{var a=this.program_(this.context_);if(a)return this.context_.stop_(),{value:a.value,done:!1}}catch(b){this.context_.yieldResult=void 0,this.context_.throw_(b)}this.context_.stop_();if(this.context_.abruptCompletion_){a=this.context_.abruptCompletion_;this.context_.abruptCompletion_=null;if(a.isException)throw a.exception;return{value:a.return,done:!0}}return{value:void 0,done:!0}};
$jscomp.generator.Generator_=function(a){this.next=function(b){return a.next_(b)};this.throw=function(b){return a.throw_(b)};this.return=function(b){return a.return_(b)};this[Symbol.iterator]=function(){return this}};$jscomp.generator.createGenerator=function(a,b){b=new $jscomp.generator.Generator_(new $jscomp.generator.Engine_(b));$jscomp.setPrototypeOf&&a.prototype&&$jscomp.setPrototypeOf(b,a.prototype);return b};
$jscomp.asyncExecutePromiseGenerator=function(a){function b(e){return a.next(e)}function c(e){return a.throw(e)}return new Promise(function(e,d){function f(g){g.done?e(g.value):Promise.resolve(g.value).then(b,c).then(f,d)}f(a.next())})};$jscomp.asyncExecutePromiseGeneratorFunction=function(a){return $jscomp.asyncExecutePromiseGenerator(a())};$jscomp.asyncExecutePromiseGeneratorProgram=function(a){return $jscomp.asyncExecutePromiseGenerator(new $jscomp.generator.Generator_(new $jscomp.generator.Engine_(a)))};
$jscomp.getRestArguments=function(){for(var a=Number(this),b=[],c=a;c<arguments.length;c++)b[c-a]=arguments[c];return b};
function initApp(){var a,b;return $jscomp.asyncExecutePromiseGeneratorProgram(function(c){if(1==c.nextAddress)return b=null==(a=(new URL(window.location.href)).searchParams.get("view"))?void 0:a.toLowerCase(),c.yield(initEditor(b),2);if(3!=c.nextAddress){var e=analyseUrl(window.location.href),d,f=null==(d=document.editor)?void 0:d.getValue(),g;document.appData=Object.assign({},null==(g=window.opener)?void 0:g.document.appData);0===Object.keys(document.appData).length&&(document.appData={encodedDiagram:e.encodedDiagram,
index:e.index,numberOfDiagramPages:f?getNumberOfDiagramPagesFromCode(f):1});initTheme();initAppCommunication();return c.yield(initPreview(b),3)}initModals(b);document.editor&&(document.editor.focus(),"SyfFKj2rKt3CoKnELR1Io4ZDoSa70000"==document.appData.encodedDiagram&&document.editor.setSelection({startLineNumber:2,endLineNumber:2,startColumn:1,endColumn:21}));document.appConfig.autoRefreshState="complete";c.jumpToEnd()})}window.onload=initApp;
var $jscomp$destructuring$var0=function(){return{setEditorValue:function(a,b,c){c=void 0===c?{}:c;var e=void 0===c.forceMoveMarkers?void 0:c.forceMoveMarkers;(void 0===c.suppressEditorChangedMessage?0:c.suppressEditorChangedMessage)&&a===document.editor&&suppressNextMessage("editor");a.executeEdits("",[{range:a.getModel().getFullModelRange(),text:b,forceMoveMarkers:e}])},initEditor:function(a){function b(){return new Promise(function(g,h){require.config({paths:{vs:"webjars/monaco-editor/0.36.1/min/vs"}});
require(["vs/editor/editor.main"],g)})}function c(){function g(l,q,n){function p(){document.appConfig.autoRefreshState="started";var t=getNumberOfDiagramPagesFromCode(l),u=document.appData.index;void 0===u||1===t?u=void 0:u>=t&&(u=t-1);makeRequest("POST","coder",{data:l}).then(function(v){sendMessage({sender:q,data:{encodedDiagram:v,numberOfDiagramPages:t,index:u},synchronize:!0})})}n=void 0===n?!0:n;var r=function(){return function(){var t=document.editor.getModel();h=h||new PlantUmlLanguageFeatures;
h.validateCode(t).then(function(u){return monaco.editor.setModelMarkers(t,"plantuml",u)})}}();q&&n&&p();r()}var h,k=monaco.editor.createModel(function(){var l=document.getElementById("initCode"),q=l.value;l.remove();return q}(),"apex",monaco.Uri.parse("inmemory://plantuml")),m=0;k.onDidChangeContent(function(){clearTimeout(m);document.appConfig.autoRefreshState="waiting";m=setTimeout(function(){return g(k.getValue(),"editor")},document.appConfig.editorWatcherTimeout)});return k}function e(){return{get:function(){},
getBoolean:function(g){return"expandSuggestionDocs"===g},getNumber:function(){return 0},remove:function(){},store:function(){},onWillSaveState:function(){},onDidChangeStorage:function(){},onDidChangeValue:function(){}}}var d,f;return $jscomp.asyncExecutePromiseGeneratorProgram(function(g){if(1==g.nextAddress)return g.yield(b(),2);"previewer"!==a&&(d=c(),f=e(),document.editor=monaco.editor.create(document.getElementById("monaco-editor"),Object.assign({},{model:d},document.appConfig.editorCreateOptions),
{storageService:f}),document.addEventListener("resize",function(){return document.editor.layout()}),initEditorUrlInput(),initEditorMenu());g.jumpToEnd()})}}}(),setEditorValue=$jscomp$destructuring$var0.setEditorValue,initEditor=$jscomp$destructuring$var0.initEditor;
function initEditorMenu(){document.getElementById("menu-item-editor-code-copy").addEventListener("click",function(){var a=document.editor.getModel().getFullModelRange();document.editor.focus();document.editor.setSelection(a);a=document.editor.getValue();var b;null==(b=navigator.clipboard)||b.writeText(a).catch(function(){})})}
var $jscomp$destructuring$var3=function(){function a(b,c,e){var d=void 0===c?{}:c;c=void 0===d.encodedDiagram?void 0:d.encodedDiagram;d=void 0===d.index?void 0:d.index;e=void 0===e?{}:e;if(b||c)(void 0===e.suppressEditorChangedMessage?0:e.suppressEditorChangedMessage)&&suppressNextMessage("url"),document.getElementById("url").value=b?b:resolvePath(buildUrl("png",c,d))}return{setUrlValue:a,initEditorUrlInput:function(){var b=document.getElementById("url");a(resolvePath(b.value));b.addEventListener("change",
function(c){var e,d;return $jscomp.asyncExecutePromiseGeneratorProgram(function(f){if(1==f.nextAddress)return document.appConfig.autoRefreshState="started",c.target.title=c.target.value,e=analyseUrl(c.target.value),f.yield(makeRequest("GET","coder/"+e.encodedDiagram),2);d=f.yieldResult;setEditorValue(document.editor,d,{suppressEditorChangedMessage:!0});sendMessage({sender:"url",data:{encodedDiagram:e.encodedDiagram,index:e.index},synchronize:!0});f.jumpToEnd()})});document.getElementById("url-copy-btn").addEventListener("click",
function(){b.focus();b.select();var c;null==(c=navigator.clipboard)||c.writeText(b.value).catch(function(){})})}}}(),setUrlValue=$jscomp$destructuring$var3.setUrlValue,initEditorUrlInput=$jscomp$destructuring$var3.initEditorUrlInput;
function initDiagramExport(){function a(){setVisibility(document.getElementById("diagram-export"),!0,!0);var f=document.editor.getValue();f=Array.from(f.matchAll(/^\s*@start[a-zA-Z]*\s+([a-zA-Z-_\u00e4\u00f6\u00fc\u00c4\u00d6\u00dc\u00df ]+)\s*$/gm),function(g){return g[1]})[0]||"diagram";e.value=f+".puml";d.value="code";e.focus()}function b(f){var g=f.lastIndexOf(".");return 1>g?{name:f,ext:null}:g===f.length-1?{name:f.slice(0,-1),ext:null}:{name:f.substring(0,g),ext:f.substring(g+1)}}function c(f){if(!f)return f;
f=f.toLowerCase();switch(f){case "puml":case "plantuml":case "code":return"code";case "ascii":return"txt";default:return f}}var e=document.getElementById("download-name"),d=document.getElementById("download-type");registerModalListener("diagram-export",a);e.addEventListener("change",function(f){f=b(f.target.value).ext;if(f=c(f))d.value=f});d.addEventListener("change",function(f){f=f.target.value;a:switch(f){case "epstext":f="eps";break a;case "code":f="puml"}var g=b(e.value).name;e.value=g+"."+f});
document.getElementById("diagram-export-ok-btn").addEventListener("click",function(){var f=e.value,g=d.value,h=document.createElement("a");h.download=f;"code"===g?(f=document.editor.getValue(),h.href="data:,"+encodeURIComponent(f)):h.href=void 0!==document.appData.index?g+"/"+document.appData.index+"/"+document.appData.encodedDiagram:g+"/"+document.appData.encodedDiagram;h.click()});window.addEventListener("keydown",function(f){"s"===f.key&&(isMac?f.metaKey:f.ctrlKey)&&(f.preventDefault(),isModalOpen("diagram-export")||
a())},!1)}
function initDiagramImport(){function a(m){m=void 0===m?!0:m;setVisibility(f,!0,!0);f.dataset.isOpenManually=m.toString();g.value="";c(g)}function b(){g.value="";c(g);f.removeAttribute("data-is-open-manually");setVisibility(f,!1)}function c(m){k.innerText="";var l;h.disabled=1>(null==(l=m.files)?void 0:l.length)}function e(m){function l(n){var p=n.name,r=n.type;n=["plain","text","plantuml","puml"];if(0<n.filter(function(u){return-1!==r.toLowerCase().indexOf(u)}).length)return!0;if(-1===p.indexOf("."))return!1;
var t=p.substring(p.lastIndexOf(".")+1).toLowerCase();n=["txt","puml","plantuml"];return 0<n.filter(function(u){return t===u}).length}var q=function(n){var p=n.name,r=n.type;n=["png","svg"];var t=n.filter(function(v){return-1!==r.toLowerCase().indexOf(v)})[0];if(t)return t;if(-1!==p.indexOf(".")){var u=p.substring(p.lastIndexOf(".")+1).toLowerCase();return n.filter(function(v){return u===v})[0]}}(m);m=void 0===q?l(m):!1;q||m||(k.innerText="File not supported. Only PNG and SVG diagram images as well as PlantUML code text files are supported.");
return{type:q,isDiagramCode:m,valid:q||m}}function d(m,l){function q(n){var p=new FormData;p.append("diagram",n,n.name);return makeRequest("POST","metadata",{data:p,responseType:"json",headers:{Accept:"application/json"}})}f.classList.add("wait");return(new Promise(function(n,p){if(l.type)q(m).then(function(t){setEditorValue(document.editor,t.decoded);n()},function(t){t=t.response;k.innerText=t.message||t;p()});else if(l.isDiagramCode){var r=new FileReader;r.onload=function(t){setEditorValue(document.editor,
t.target.result)};r.readAsText(m);n()}else k.innerText="File not supported. Only PNG and SVG diagram images as well as PlantUML code text files are supported.",p()})).then(function(){return b()},function(){}).finally(function(){return f.classList.remove("wait")})}var f=document.getElementById("diagram-import"),g=document.getElementById("diagram-import-input"),h=document.getElementById("diagram-import-ok-btn"),k=document.getElementById("diagram-import-error-message");window.addEventListener("dragenter",
function(m){m.stopPropagation();m.preventDefault();isVisible(f)||a(!1)},!1);g.addEventListener("dragenter",function(m){return m.target.classList.add("drop-able")},!1);g.addEventListener("dragover",function(m){m.stopPropagation();m.preventDefault();null!==m.dataTransfer&&(m.dataTransfer.dropEffect="copy")},!1);g.addEventListener("dragexit",function(m){return m.target.classList.remove("drop-able")},!1);g.addEventListener("drop",function(m){function l(){m.stopPropagation();m.preventDefault()}var q=m.dataTransfer.files||
m.target.files;if(!q||1>q.length)return l();q=q[0];var n=e(q);if(!n.valid)return l();"true"!==f.dataset.isOpenManually&&(l(),d(q,n))},!1);g.addEventListener("change",function(m){return c(m.target)});h.addEventListener("click",function(){var m=g.files[0];d(m,e(m))});registerModalListener("diagram-import",a,b)}
var $jscomp$destructuring$var16=function(){var a={};return{registerModalListener:function(b,c,e){a[b]={fnOpen:c,fnClose:e}},openModal:function(b){var c=$jscomp.getRestArguments.apply(1,arguments),e,d=null==(e=a[b])?void 0:e.fnOpen;d?d.apply(null,$jscomp.arrayFromIterable(c)):setVisibility(document.getElementById(b),!0,!0)},closeModal:function(b){var c=$jscomp.getRestArguments.apply(1,arguments),e,d=null==(e=a[b])?void 0:e.fnClose;d?d.apply(null,$jscomp.arrayFromIterable(c)):setVisibility(document.getElementById(b),
!1)}}}(),registerModalListener=$jscomp$destructuring$var16.registerModalListener,openModal=$jscomp$destructuring$var16.openModal,closeModal=$jscomp$destructuring$var16.closeModal;
function initModals(a){function b(c){"Escape"===c.key||"Esc"===c.key?(c.preventDefault(),closeModal(c.target.closest(".modal").id)):"Enter"===c.key&&(c.preventDefault(),(c=c.target.closest(".modal").querySelector('input.ok[type\x3d"button"]'))&&!c.disabled&&c.click())}document.querySelectorAll(".modal").forEach(function(c){c.addEventListener("keydown",b,!1)});initSettings();"previewer"!==a&&(initDiagramExport(),initDiagramImport())}
function isModalOpen(a){return isVisible(document.getElementById(a))}function closeAllModals(){document.querySelectorAll(".modal").forEach(function(a){return closeModal(a.id)})}
function initSettings(){function a(){setVisibility(document.getElementById("settings"),!0,!0);b.value=document.appConfig.theme;c.value=document.appConfig.diagramPreviewType;e.value=document.appConfig.editorWatcherTimeout;setEditorValue(document.settingsEditor,JSON.stringify(document.appConfig.editorCreateOptions,null,"  "))}var b=document.getElementById("theme"),c=document.getElementById("diagramPreviewType"),e=document.getElementById("editorWatcherTimeout");document.settingsEditor=monaco.editor.create(document.getElementById("settings-monaco-editor"),
Object.assign({},{language:"json"},document.appConfig.editorCreateOptions));b.addEventListener("change",function(d){d=d.target.value;var f=document.settingsEditor.getValue();setEditorValue(document.settingsEditor,f.replace(new RegExp('("theme"\\s*:\\s*)"'+("dark"===d?"vs":"vs-dark")+'"',"gm"),'$1"'+("dark"===d?"vs-dark":"vs")+'"'))});document.getElementById("settings-ok-btn").addEventListener("click",function(){var d=Object.assign({},document.appConfig);d.theme=b.value;d.editorWatcherTimeout=e.value;
d.diagramPreviewType=c.value;d.editorCreateOptions=JSON.parse(document.settingsEditor.getValue());updateConfig(d);closeModal("settings")});window.addEventListener("keydown",function(d){","===d.key&&(isMac?d.metaKey:d.ctrlKey)&&(d.preventDefault(),isModalOpen("settings")||a())},!1);registerModalListener("settings",a)}
function initializeDiagram(){return $jscomp.asyncExecutePromiseGeneratorProgram(function(a){if("png"!==document.appConfig.diagramPreviewType)return a.return(setDiagram(document.appConfig.diagramPreviewType,document.appData.encodedDiagram,document.appData.index));a.jumpToEnd()})}
function setDiagram(a,b,c){function e(n,p,r){return $jscomp.asyncExecutePromiseGeneratorProgram(function(t){return t.return(makeRequest("GET",buildUrl(n,p,r)))})}var d,f,g,h,k,m,l,q;return $jscomp.asyncExecutePromiseGeneratorProgram(function(n){switch(n.nextAddress){case 1:d=document.getElementById("diagram");f=document.getElementById("diagram-png");g=document.getElementById("diagram-txt");h=document.getElementById("diagram-pdf");n.setCatchFinallyBlocks(2);if("png"===a)return f.src=buildUrl("png",
b,c),n.yield(e("map",b,c),11);if("svg"===a)return n.yield(e("svg",b,c),10);if("txt"!==a){if("pdf"===a)h.data=buildUrl("pdf",b,c);else return k="unknown diagram type: "+a,(console.error||console.log)(k),n.return(Promise.reject(k));n.jumpTo(5);break}m=g;return n.yield(e("txt",b,c),9);case 9:m.innerHTML=n.yieldResult;n.jumpTo(5);break;case 10:l=n.yieldResult;var p=document.getElementById("diagram-svg"),r=document.createElement("div");r.innerHTML=l;r=r.querySelector("svg");r.id="diagram-svg";r.classList=
p.classList;r.style.cssText=p.style.cssText;p.parentNode.replaceChild(r,p);n.jumpTo(5);break;case 11:if(q=n.yieldResult,p=document.getElementById("plantuml_map"),r=document.getElementById("map-diagram-link"),q){var t=document.createElement("div");t.innerHTML=q;p.parentNode.replaceChild(t.firstChild,p);setVisibility(r,!0)}else removeChildren(p),setVisibility(r,!1);case 5:p=document.getElementById("plantuml_map");r=document.getElementById("diagram-svg");d.setAttribute("data-diagram-type",a);setVisibility(f,
"png"===a);setVisibility(p,"png"===a);setVisibility(r,"svg"===a);setVisibility(g,"txt"===a);setVisibility(h,"pdf"===a);n.leaveTryBlock(0);break;case 2:n.enterCatchBlock(),n.jumpToEnd()}})}function getNumberOfDiagramPagesFromCode(a){var b;return(null==(b=a.match(/^\s*newpage\s?.*$/gm))?void 0:b.length)+1||1}
function updatePaginatorSelection(){var a=document.getElementById("paginator"),b=document.appData.index;if(void 0===b||a.childNodes.length<=b)for(a=$jscomp.makeIterator(a.childNodes),b=a.next();!b.done;b=a.next())b.value.checked=!1;else a.childNodes[b].checked=!0}
var updatePaginator=function(){function a(b,c){for(;b.childElementCount>c;)b.removeChild(b.lastChild);for(;b.childElementCount<c;){var e=document.createElement("input");e.name="paginator";e.type="radio";e.value=b.childElementCount;e.addEventListener("click",function(d){sendMessage({sender:"paginator",data:{index:d.target.value},synchronize:!0})});b.appendChild(e)}}return function(){var b=document.getElementById("paginator"),c=document.appData.numberOfDiagramPages;1<c?(a(b,c),setVisibility(b,!0)):
setVisibility(b,!1)}}();function initializePaginator(){1<document.appData.numberOfDiagramPages&&(updatePaginator(),updatePaginatorSelection())}
function initPreview(a){function b(){setVisibility(d,!1);setVisibility(f,window.opener);g&&(g.style.width="100%");h&&setVisibility(h,!1)}function c(){setVisibility(d,!0);setVisibility(f,!1);g&&g.style.removeProperty("width");h&&setVisibility(h,!0)}function e(){var k=new URL(window.location.href);k.searchParams.set("view","previewer");if(k=window.open(k,"PlantUML Diagram Previewer","popup"))k.onbeforeunload=c,b()}var d,f,g,h;return $jscomp.asyncExecutePromiseGeneratorProgram(function(k){if(1==k.nextAddress)return d=
document.getElementById("btn-undock"),f=document.getElementById("btn-dock"),g=document.getElementById("editor-main-container"),h=document.getElementById("previewer-main-container"),d.addEventListener("click",e),k.yield(initializeDiagram(),2);initializePaginator();["previewer","editor"].includes(a)&&b();k.jumpToEnd()})}var currentUser=null,currentToken=null,currentHistoryId=null,currentIsFavorite=!1,currentPage=1,pageSize=12,API_BASE_URL=window.location.origin+"/plantuml/api";
document.addEventListener("DOMContentLoaded",function(){var a=localStorage.getItem("authToken"),b=localStorage.getItem("currentUser");a&&b?(currentToken=a,currentUser=JSON.parse(b),showMainApp()):showAuthModal();setupModalEvents()});
function setupModalEvents(){var a=document.getElementById("authModal"),b=document.querySelector(".close"),c=document.querySelectorAll(".auth-tab");b&&(b.onclick=function(){currentToken&&(a.style.display="none")});c.forEach(function(e){e.addEventListener("click",function(){switchAuthTab(this.dataset.tab)})});document.getElementById("loginPassword").addEventListener("keypress",function(e){"Enter"===e.key&&handleLogin()});document.getElementById("registerPassword").addEventListener("keypress",function(e){"Enter"===
e.key&&handleRegister()})}function switchAuthTab(a){document.querySelectorAll(".auth-tab").forEach(function(b){return b.classList.remove("active")});document.querySelectorAll(".auth-form").forEach(function(b){return b.classList.remove("active")});document.querySelector('[data-tab\x3d"'+a+'"]').classList.add("active");document.getElementById(a+"Form").classList.add("active");document.querySelectorAll(".error-message").forEach(function(b){b.classList.remove("show");b.textContent=""})}
function showAuthModal(){document.getElementById("authModal").style.display="flex";document.getElementById("mainApp").style.display="none"}function showMainApp(){document.getElementById("authModal").style.display="none";document.getElementById("mainApp").style.display="block";currentUser&&(document.getElementById("userDisplayName").textContent=currentUser.fullName||currentUser.username);showSection("editor")}
function handleLogin(){var a,b,c,e,d,f;return $jscomp.asyncExecutePromiseGeneratorProgram(function(g){switch(g.nextAddress){case 1:a=document.getElementById("loginUsername").value.trim();b=document.getElementById("loginPassword").value;c=document.getElementById("loginError");if(!a||!b)return showError(c,"\u8bf7\u8f93\u5165\u7528\u6237\u540d\u548c\u5bc6\u7801"),g.return();g.setCatchFinallyBlocks(2);return g.yield(fetch(API_BASE_URL+"/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},
body:JSON.stringify({username:a,password:b})}),4);case 4:return e=g.yieldResult,g.yield(e.json(),5);case 5:d=g.yieldResult;d.success?(currentToken=d.token,currentUser=d.user,localStorage.setItem("authToken",currentToken),localStorage.setItem("currentUser",JSON.stringify(currentUser)),showToast("\u767b\u5f55\u6210\u529f\uff01","success"),showMainApp()):showError(c,d.message||"\u767b\u5f55\u5931\u8d25");g.leaveTryBlock(0);break;case 2:f=g.enterCatchBlock(),showError(c,"\u7f51\u7edc\u9519\u8bef\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5"),
console.error("Login error:",f),g.jumpToEnd()}})}
function handleRegister(){var a,b,c,e,d,f,g,h;return $jscomp.asyncExecutePromiseGeneratorProgram(function(k){switch(k.nextAddress){case 1:a=document.getElementById("registerUsername").value.trim();b=document.getElementById("registerEmail").value.trim();c=document.getElementById("registerPassword").value;e=document.getElementById("registerFullName").value.trim();d=document.getElementById("registerError");if(!a||!b||!c)return showError(d,"\u8bf7\u586b\u5199\u6240\u6709\u5fc5\u586b\u9879"),k.return();
if(6>c.length)return showError(d,"\u5bc6\u7801\u957f\u5ea6\u81f3\u5c11\u4e3a6\u4f4d"),k.return();k.setCatchFinallyBlocks(2);return k.yield(fetch(API_BASE_URL+"/auth/register",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:a,email:b,password:c,fullName:e})}),4);case 4:return f=k.yieldResult,k.yield(f.json(),5);case 5:g=k.yieldResult;g.success?(currentToken=g.token,currentUser=g.user,localStorage.setItem("authToken",currentToken),localStorage.setItem("currentUser",
JSON.stringify(currentUser)),showToast("\u6ce8\u518c\u6210\u529f\uff01","success"),showMainApp()):showError(d,g.message||"\u6ce8\u518c\u5931\u8d25");k.leaveTryBlock(0);break;case 2:h=k.enterCatchBlock(),showError(d,"\u7f51\u7edc\u9519\u8bef\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5"),console.error("Register error:",h),k.jumpToEnd()}})}
function handleLogout(){localStorage.removeItem("authToken");localStorage.removeItem("currentUser");currentUser=currentToken=null;showToast("\u5df2\u9000\u51fa\u767b\u5f55","success");showAuthModal()}function showError(a,b){a.textContent=b;a.classList.add("show");setTimeout(function(){a.classList.remove("show")},5E3)}
function showToast(a,b){b=void 0===b?"success":b;var c=document.getElementById("toast");c.textContent=a;c.className="toast "+b+" show";setTimeout(function(){c.classList.remove("show")},3E3)}function showSection(a){document.querySelectorAll(".content-section").forEach(function(b){return b.classList.remove("active")});document.getElementById(a+"Section").classList.add("active");"history"===a?loadHistory():"favorites"===a&&loadFavorites()}
function generateDiagram(){var a,b,c,e,d,f,g;return $jscomp.asyncExecutePromiseGeneratorProgram(function(h){switch(h.nextAddress){case 1:a=document.getElementById("descriptionInput").value.trim();b=document.getElementById("diagramTitle").value.trim();c=document.getElementById("saveHistory").checked;if(!a)return showToast("\u8bf7\u8f93\u5165\u56fe\u8868\u63cf\u8ff0","error"),h.return();e=document.getElementById("previewLoading");e.style.display="flex";h.setCatchFinallyBlocks(2,3);return h.yield(fetch(API_BASE_URL+
"/ai/convert",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+currentToken},body:JSON.stringify({description:a,title:b||"\u672a\u547d\u540d\u56fe\u8868",saveHistory:c})}),5);case 5:return d=h.yieldResult,h.yield(d.json(),6);case 6:f=h.yieldResult,f.success?(document.getElementById("plantumlCode").value=f.plantumlCode,f.historyId&&(currentHistoryId=f.historyId,currentIsFavorite=!1,updateFavoriteButton()),showToast("\u751f\u6210\u6210\u529f\uff01","success"),refreshPreview()):
showToast(f.message||"\u751f\u6210\u5931\u8d25","error");case 3:h.enterFinallyBlock();e.style.display="none";h.leaveFinallyBlock(0);break;case 2:g=h.enterCatchBlock(),showToast("\u7f51\u7edc\u9519\u8bef\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5","error"),console.error("Generate error:",g),h.jumpTo(3)}})}
function optimizeDiagram(){var a,b,c,e,d,f,g,h,k,m;return $jscomp.asyncExecutePromiseGeneratorProgram(function(l){switch(l.nextAddress){case 1:a=document.getElementById("plantumlCode");b=a.value.trim();c=document.getElementById("optimizeInstruction");e=c.value.trim();if(!b)return showToast("\u8bf7\u5148\u751f\u6210PlantUML\u4ee3\u7801","error"),l.return();if(!e)return showToast("\u8bf7\u8f93\u5165\u4f18\u5316\u6307\u4ee4","error"),l.return();d=document.getElementById("previewLoading");d.style.display=
"flex";l.setCatchFinallyBlocks(2,3);console.log("\u53d1\u9001\u4f18\u5316\u8bf7\u6c42...");return l.yield(fetch(API_BASE_URL+"/ai/optimize",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+currentToken},body:JSON.stringify({plantumlCode:b,instruction:e})}),5);case 5:return f=l.yieldResult,l.yield(f.json(),6);case 6:g=l.yieldResult;console.log("\u4f18\u5316\u54cd\u5e94:",g);if(!g.success||!g.plantumlCode){console.error("\u4f18\u5316\u5931\u8d25:",g);showToast(g.message||
"\u4f18\u5316\u5931\u8d25","error");l.jumpTo(3);break}a.value=g.plantumlCode;a.dispatchEvent(new Event("input",{bubbles:!0}));console.log("\u4ee3\u7801\u5df2\u66f4\u65b0:",g.plantumlCode.substring(0,100)+"...");h=document.getElementById("saveHistory").checked;k="\u4f18\u5316\uff1a"+e;if(currentHistoryId)return l.yield(updateHistoryRecord(currentHistoryId,g.plantumlCode,k),9);if(!h){l.jumpTo(9);break}return l.yield(saveOptimizedToHistory(g.plantumlCode,k),9);case 9:c.value="",showToast("\u4f18\u5316\u6210\u529f\uff01\u4ee3\u7801\u5df2\u66f4\u65b0",
"success"),setTimeout(function(){refreshPreview()},100);case 3:l.enterFinallyBlock();d.style.display="none";l.leaveFinallyBlock(0);break;case 2:m=l.enterCatchBlock(),console.error("Optimize error:",m),showToast("\u7f51\u7edc\u9519\u8bef\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5","error"),l.jumpTo(3)}})}
function updateHistoryRecord(a,b,c){var e,d,f;return $jscomp.asyncExecutePromiseGeneratorProgram(function(g){switch(g.nextAddress){case 1:return g.setCatchFinallyBlocks(2),g.yield(fetch(API_BASE_URL+"/history/"+a,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer "+currentToken},body:JSON.stringify({plantumlCode:b,title:document.getElementById("diagramTitle").value.trim()||"\u672a\u547d\u540d\u56fe\u8868",changeDescription:c||"AI\u4f18\u5316\u66f4\u65b0"})}),4);case 4:return e=
g.yieldResult,g.yield(e.json(),5);case 5:d=g.yieldResult;d.success&&console.log("\u5386\u53f2\u8bb0\u5f55\u5df2\u66f4\u65b0\uff0c\u7248\u672c\u5df2\u4fdd\u5b58:",c);g.leaveTryBlock(0);break;case 2:f=g.enterCatchBlock(),console.error("Update history error:",f),g.jumpToEnd()}})}
function viewVersionHistory(a){var b,c,e;return $jscomp.asyncExecutePromiseGeneratorProgram(function(d){switch(d.nextAddress){case 1:return d.setCatchFinallyBlocks(2),d.yield(fetch(API_BASE_URL+"/history/"+a+"/versions",{headers:{Authorization:"Bearer "+currentToken}}),4);case 4:return b=d.yieldResult,d.yield(b.json(),5);case 5:c=d.yieldResult;c.success?showVersionModal(c.data,a):showToast(c.message||"\u83b7\u53d6\u7248\u672c\u5931\u8d25","error");d.leaveTryBlock(0);break;case 2:e=d.enterCatchBlock(),
showToast("\u7f51\u7edc\u9519\u8bef\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5","error"),console.error("View version history error:",e),d.jumpToEnd()}})}
function showVersionModal(a,b){if(0===a.length)showToast("\u6682\u65e0\u5386\u53f2\u7248\u672c","info");else{var c=document.createElement("div");c.className="version-modal";c.innerHTML='\n        \x3cdiv class\x3d"version-modal-content"\x3e\n            \x3cdiv class\x3d"version-modal-header"\x3e\n                \x3ch3\x3e\x3ci class\x3d"fas fa-history"\x3e\x3c/i\x3e \u7248\u672c\u5386\u53f2\uff08\u6700\u8fd120\u4e2a\u7248\u672c\uff09\x3c/h3\x3e\n                \x3cbutton class\x3d"version-modal-close" onclick\x3d"this.closest(\'.version-modal\').remove()"\x3e\n                    \x3ci class\x3d"fas fa-times"\x3e\x3c/i\x3e\n                \x3c/button\x3e\n            \x3c/div\x3e\n            \x3cdiv class\x3d"version-modal-body"\x3e\n                        \x3cdiv class\x3d"version-list"\x3e\n                            '+a.map(function(e){return'\n                                \x3cdiv class\x3d"version-item" onclick\x3d"restoreVersion('+
e.id+", "+b+')"\x3e\n                                    \x3cdiv class\x3d"version-item-header"\x3e\n                                        \x3cspan class\x3d"version-number"\x3e'+escapeHtml(e.title||"\u7248\u672c "+e.versionNumber)+'\x3c/span\x3e\n                                        \x3cspan class\x3d"version-date"\x3e'+formatDate(e.createdAt)+"\x3c/span\x3e\n                                    \x3c/div\x3e\n                                    "+(e.changeDescription?'\x3cdiv class\x3d"version-item-desc"\x3e'+
escapeHtml(e.changeDescription)+"\x3c/div\x3e":"")+"\n                                \x3c/div\x3e\n                            "}).join("")+'\n                        \x3c/div\x3e\n            \x3c/div\x3e\n            \x3cdiv class\x3d"version-modal-footer"\x3e\n                \x3cbutton class\x3d"btn-secondary" onclick\x3d"this.closest(\'.version-modal\').remove()"\x3e\u5173\u95ed\x3c/button\x3e\n            \x3c/div\x3e\n        \x3c/div\x3e\n    ';document.body.appendChild(c);c.addEventListener("click",
function(e){e.target===c&&c.remove()})}}
function restoreVersion(a,b){var c,e,d,f,g;return $jscomp.asyncExecutePromiseGeneratorProgram(function(h){switch(h.nextAddress){case 1:if(!confirm("\u786e\u5b9a\u8981\u6062\u590d\u5230\u6b64\u7248\u672c\u5417\uff1f\u5f53\u524d\u672a\u4fdd\u5b58\u7684\u4fee\u6539\u5c06\u4f1a\u4e22\u5931\u3002"))return h.return();h.setCatchFinallyBlocks(2);return h.yield(fetch(API_BASE_URL+"/history/"+b+"/versions/"+a,{headers:{Authorization:"Bearer "+currentToken}}),4);case 4:return c=h.yieldResult,h.yield(c.json(),
5);case 5:e=h.yieldResult;if(!e.success){showToast(e.message||"\u6062\u590d\u5931\u8d25","error");h.jumpTo(6);break}d=e.data;document.getElementById("plantumlCode").value=d.plantumlCode;null==(f=document.querySelector(".version-modal"))||f.remove();refreshPreview();showToast("\u5df2\u6062\u590d\u5230\uff1a"+(d.title||"\u7248\u672c "+d.versionNumber),"success");return h.yield(updateHistoryRecord(b,d.plantumlCode,"\u6062\u590d\u7248\u672c\uff1a"+(d.title||"\u7248\u672c "+d.versionNumber)),6);case 6:h.leaveTryBlock(0);
break;case 2:g=h.enterCatchBlock(),showToast("\u7f51\u7edc\u9519\u8bef\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5","error"),console.error("Restore version error:",g),h.jumpToEnd()}})}
function saveOptimizedToHistory(a,b){var c,e,d;return $jscomp.asyncExecutePromiseGeneratorProgram(function(f){switch(f.nextAddress){case 1:return f.setCatchFinallyBlocks(2),f.yield(fetch(API_BASE_URL+"/history",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+currentToken},body:JSON.stringify({originalText:document.getElementById("descriptionInput").value.trim(),plantumlCode:a,title:document.getElementById("diagramTitle").value.trim()||"\u672a\u547d\u540d\u56fe\u8868",
description:b||"\u9996\u6b21\u4fdd\u5b58"})}),4);case 4:return c=f.yieldResult,f.yield(c.json(),5);case 5:e=f.yieldResult;e.success&&e.id&&(currentHistoryId=e.id,currentIsFavorite=!1,updateFavoriteButton(),console.log("\u5df2\u4fdd\u5b58\u5230\u5386\u53f2\u8bb0\u5f55:",b));f.leaveTryBlock(0);break;case 2:d=f.enterCatchBlock(),console.error("Save optimized history error:",d),f.jumpToEnd()}})}
function refreshPreview(){var a,b,c,e,d,f;return $jscomp.asyncExecutePromiseGeneratorProgram(function(g){switch(g.nextAddress){case 1:a=document.getElementById("plantumlCode").value.trim();if(!a)return showToast("\u8bf7\u5148\u751f\u6210PlantUML\u4ee3\u7801","warning"),g.return();b=document.getElementById("previewContainer");b.innerHTML='\x3cdiv class\x3d"loading-spinner"\x3e\x3ci class\x3d"fas fa-spinner fa-spin"\x3e\x3c/i\x3e\x3cp\x3e\u751f\u6210\u9884\u89c8\u4e2d...\x3c/p\x3e\x3c/div\x3e';g.setCatchFinallyBlocks(2);
return g.yield(fetch(window.location.origin+"/plantuml/coder",{method:"POST",headers:{"Content-Type":"text/plain"},body:a}),4);case 4:c=g.yieldResult;if(!c.ok){handlePreviewError();g.jumpTo(5);break}return g.yield(c.text(),6);case 6:e=g.yieldResult,d=window.location.origin+"/plantuml/svg/"+e,b.innerHTML='\x3cimg src\x3d"'+d+'" alt\x3d"PlantUML Diagram" onerror\x3d"handlePreviewError()"\x3e',setTimeout(function(){var h=document.getElementById("fullscreenBtn");h&&b.querySelector("img")&&(h.style.display=
"inline-flex")},100);case 5:g.leaveTryBlock(0);break;case 2:f=g.enterCatchBlock(),console.error("Preview error:",f),handlePreviewError(),g.jumpToEnd()}})}function handlePreviewError(){document.getElementById("previewContainer").innerHTML='\x3cp class\x3d"preview-placeholder" style\x3d"color: var(--error-color);"\x3e\u9884\u89c8\u751f\u6210\u5931\u8d25\uff0c\u8bf7\u68c0\u67e5PlantUML\u4ee3\u7801\x3c/p\x3e'}
function clearInput(){document.getElementById("descriptionInput").value="";document.getElementById("diagramTitle").value="";document.getElementById("plantumlCode").value="";document.getElementById("previewContainer").innerHTML='\x3cp class\x3d"preview-placeholder"\x3e\u56fe\u8868\u9884\u89c8\u5c06\u5728\u8fd9\u91cc\u663e\u793a\x3c/p\x3e';currentHistoryId=null;currentIsFavorite=!1;document.getElementById("favoriteBtn").style.display="none";document.getElementById("versionBtn").style.display="none"}
function copyCode(){var a=document.getElementById("plantumlCode").value;a?navigator.clipboard.writeText(a).then(function(){showToast("\u4ee3\u7801\u5df2\u590d\u5236\u5230\u526a\u8d34\u677f","success")}).catch(function(){showToast("\u590d\u5236\u5931\u8d25","error")}):showToast("\u6ca1\u6709\u53ef\u590d\u5236\u7684\u4ee3\u7801","warning")}
function downloadCode(){var a=document.getElementById("plantumlCode").value,b=document.getElementById("diagramTitle").value||"diagram";if(a){a=new Blob([a],{type:"text/plain"});a=URL.createObjectURL(a);var c=document.createElement("a");c.href=a;c.download=b+".puml";c.click();URL.revokeObjectURL(a);showToast("\u4ee3\u7801\u5df2\u4e0b\u8f7d","success")}else showToast("\u6ca1\u6709\u53ef\u4e0b\u8f7d\u7684\u4ee3\u7801","warning")}
function downloadImage(a){var b,c,e,d,f,g,h;return $jscomp.asyncExecutePromiseGeneratorProgram(function(k){switch(k.nextAddress){case 1:b=document.getElementById("plantumlCode").value.trim();c=document.getElementById("diagramTitle").value||"diagram";if(!b)return showToast("\u8bf7\u5148\u751f\u6210\u56fe\u8868","warning"),k.return();k.setCatchFinallyBlocks(2);return k.yield(fetch(window.location.origin+"/plantuml/coder",{method:"POST",headers:{"Content-Type":"text/plain"},body:b}),4);case 4:e=k.yieldResult;
if(!e.ok){showToast("\u7f16\u7801\u5931\u8d25\uff0c\u8bf7\u68c0\u67e5PlantUML\u4ee3\u7801","error");k.jumpTo(5);break}return k.yield(e.text(),6);case 6:d=k.yieldResult,f=window.location.origin+"/plantuml/"+a+"/"+d,g=document.createElement("a"),g.href=f,g.download=c+"."+a,g.click(),showToast("\u56fe\u7247\u5df2\u4e0b\u8f7d ("+a.toUpperCase()+")","success");case 5:k.leaveTryBlock(0);break;case 2:h=k.enterCatchBlock(),console.error("Download error:",h),showToast("\u4e0b\u8f7d\u5931\u8d25\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5",
"error"),k.jumpToEnd()}})}
function loadHistory(a){a=void 0===a?1:a;var b,c,e;return $jscomp.asyncExecutePromiseGeneratorProgram(function(d){switch(d.nextAddress){case 1:return currentPage=a,d.setCatchFinallyBlocks(2),console.log("Loading history, page:",a),d.yield(fetch(API_BASE_URL+"/history?page\x3d"+a+"\x26pageSize\x3d"+pageSize,{headers:{Authorization:"Bearer "+currentToken}}),4);case 4:b=d.yieldResult;console.log("Response status:",b.status);if(!b.ok)throw Error("HTTP error! status: "+b.status);return d.yield(b.json(),
5);case 5:c=d.yieldResult;console.log("History data:",c);if(!c.success){console.error("API returned success\x3dfalse:",c.message);showToast(c.message||"\u52a0\u8f7d\u5931\u8d25","error");d.jumpTo(6);break}console.log("Displaying history list with",c.data.length,"items");return d.yield(displayHistoryList(c.data),7);case 7:displayPagination(c.total,c.page,c.pageSize);case 6:d.leaveTryBlock(0);break;case 2:e=d.enterCatchBlock(),console.error("Load history error:",e),console.error("Error stack:",e.stack),
showToast("\u7f51\u7edc\u9519\u8bef\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5: "+e.message,"error"),d.jumpToEnd()}})}
function displayHistoryList(a){var b,c,e,d;return $jscomp.asyncExecutePromiseGeneratorProgram(function(f){b=document.getElementById("historyList");if(!a||0===a.length)return b.innerHTML='\x3cp style\x3d"text-align: center; color: var(--text-muted); grid-column: 1/-1;"\x3e\u6682\u65e0\u5386\u53f2\u8bb0\u5f55\x3c/p\x3e',f.return();try{for(b.innerHTML=a.map(function(g){var h=g.isFavorite||!1,k=escapeHtml(g.title||"\u672a\u547d\u540d\u56fe\u8868"),m=escapeHtml(g.originalText||""),l=formatDate(g.createdAt);
return'\n                \x3cdiv class\x3d"history-card" onclick\x3d"loadHistoryItem('+g.id+')"\x3e\n                    \x3cdiv class\x3d"history-card-header"\x3e\n                        \x3cdiv\x3e\n                            \x3cdiv class\x3d"history-card-title"\x3e'+k+'\x3c/div\x3e\n                            \x3cdiv class\x3d"history-card-date"\x3e'+l+'\x3c/div\x3e\n                        \x3c/div\x3e\n                        \x3cdiv class\x3d"history-card-actions"\x3e\n                            \x3cbutton onclick\x3d"event.stopPropagation(); toggleFavorite('+
g.id+", "+!h+')" title\x3d"'+(h?"\u53d6\u6d88\u6536\u85cf":"\u6536\u85cf")+'"\x3e\n                                \x3ci class\x3d"'+(h?"fas":"far")+' fa-star"\x3e\x3c/i\x3e\n                            \x3c/button\x3e\n                            \x3cbutton onclick\x3d"event.stopPropagation(); deleteHistory('+g.id+')" title\x3d"\u5220\u9664"\x3e\n                                \x3ci class\x3d"fas fa-trash"\x3e\x3c/i\x3e\n                            \x3c/button\x3e\n                        \x3c/div\x3e\n                    \x3c/div\x3e\n                    \x3cdiv class\x3d"history-card-description"\x3e'+
m+'\x3c/div\x3e\n                    \x3cdiv class\x3d"history-card-preview"\x3e\n                        \x3cdiv class\x3d"loading-spinner" data-id\x3d"'+g.id+'"\x3e\u52a0\u8f7d\u4e2d...\x3c/div\x3e\n                    \x3c/div\x3e\n                \x3c/div\x3e\n            '}).join(""),c={},e=$jscomp.makeIterator(a),d=e.next();!d.done;c={$jscomp$loop$prop$history$4$12:c.$jscomp$loop$prop$history$4$12},d=e.next())c.$jscomp$loop$prop$history$4$12=d.value,encodePlantUML(c.$jscomp$loop$prop$history$4$12.plantumlCode).then(function(g){return function(h){var k=
document.querySelector('.loading-spinner[data-id\x3d"'+g.$jscomp$loop$prop$history$4$12.id+'"]');k&&k.parentElement&&(k.parentElement.innerHTML='\x3cimg src\x3d"'+window.location.origin+"/plantuml/svg/"+h+'" alt\x3d"Preview" onerror\x3d"this.src\x3d\'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48dGV4dCB4PSI1MCIgeT0iNTAiIHRleHQtYW5jaG9yPSJtaWRkbGUiPumihOiniOWksei0pTwvdGV4dD48L3N2Zz4\x3d\'"\x3e')}}(c)).catch(function(g){return function(h){console.error("Failed to encode PlantUML for history",
g.$jscomp$loop$prop$history$4$12.id,h);(h=document.querySelector('.loading-spinner[data-id\x3d"'+g.$jscomp$loop$prop$history$4$12.id+'"]'))&&h.parentElement&&(h.parentElement.innerHTML='\x3cdiv style\x3d"text-align:center;color:#999;"\x3e\u9884\u89c8\u5931\u8d25\x3c/div\x3e')}}(c))}catch(g){console.error("Error displaying history list:",g),b.innerHTML='\x3cp style\x3d"text-align: center; color: var(--text-muted); grid-column: 1/-1;"\x3e\u663e\u793a\u5386\u53f2\u8bb0\u5f55\u65f6\u51fa\u9519\x3c/p\x3e'}f.jumpToEnd()})}
function displayPagination(a,b,c){a=Math.ceil(a/c);c=document.getElementById("historyPagination");if(1>=a)c.innerHTML="";else{var e='\x3cbutton onclick\x3d"loadHistory('+(b-1)+')" '+(1>=b?"disabled":"")+"\x3e\u4e0a\u4e00\u9875\x3c/button\x3e";for(var d=1;d<=a;d++)if(1===d||d===a||d>=b-2&&d<=b+2)e+='\x3cbutton onclick\x3d"loadHistory('+d+')" class\x3d"'+(d===b?"active":"")+'"\x3e'+d+"\x3c/button\x3e";else if(d===b-3||d===b+3)e+="\x3cspan\x3e...\x3c/span\x3e";c.innerHTML=e+('\x3cbutton onclick\x3d"loadHistory('+
(b+1)+')" '+(b>=a?"disabled":"")+"\x3e\u4e0b\u4e00\u9875\x3c/button\x3e")}}
function loadHistoryItem(a){var b,c,e,d;return $jscomp.asyncExecutePromiseGeneratorProgram(function(f){switch(f.nextAddress){case 1:return f.setCatchFinallyBlocks(2),f.yield(fetch(API_BASE_URL+"/history/"+a,{headers:{Authorization:"Bearer "+currentToken}}),4);case 4:return b=f.yieldResult,f.yield(b.json(),5);case 5:c=f.yieldResult;c.success?(e=c.data,document.getElementById("descriptionInput").value=e.originalText,document.getElementById("plantumlCode").value=e.plantumlCode,document.getElementById("diagramTitle").value=
e.title,currentHistoryId=e.id,currentIsFavorite=e.isFavorite||!1,updateFavoriteButton(),showSection("editor"),refreshPreview(),showToast("\u5df2\u52a0\u8f7d\u5386\u53f2\u8bb0\u5f55","success")):showToast(c.message||"\u52a0\u8f7d\u5931\u8d25","error");f.leaveTryBlock(0);break;case 2:d=f.enterCatchBlock(),showToast("\u7f51\u7edc\u9519\u8bef\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5","error"),console.error("Load history item error:",d),f.jumpToEnd()}})}
function toggleFavorite(a,b){var c,e,d,f;return $jscomp.asyncExecutePromiseGeneratorProgram(function(g){switch(g.nextAddress){case 1:return g.setCatchFinallyBlocks(2),g.yield(fetch(API_BASE_URL+"/history/"+a+"/favorite",{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer "+currentToken},body:JSON.stringify({isFavorite:b})}),4);case 4:return c=g.yieldResult,g.yield(c.json(),5);case 5:e=g.yieldResult;e.success?(showToast(e.message,"success"),(d=document.querySelector(".content-section.active"))&&
"favoritesSection"===d.id?loadFavorites():loadHistory(currentPage),currentHistoryId===a&&(currentIsFavorite=b,updateFavoriteButton())):showToast(e.message||"\u64cd\u4f5c\u5931\u8d25","error");g.leaveTryBlock(0);break;case 2:f=g.enterCatchBlock(),showToast("\u7f51\u7edc\u9519\u8bef\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5","error"),console.error("Toggle favorite error:",f),g.jumpToEnd()}})}
function toggleCurrentFavorite(){var a,b,c,e,d,f,g,h,k,m;return $jscomp.asyncExecutePromiseGeneratorProgram(function(l){switch(l.nextAddress){case 1:if(!currentHistoryId){d=document.getElementById("plantumlCode").value.trim();f=document.getElementById("descriptionInput").value.trim();g=document.getElementById("diagramTitle").value.trim()||"\u672a\u547d\u540d\u56fe\u8868";if(!d||!f)return showToast("\u8bf7\u5148\u751f\u6210\u56fe\u8868","error"),l.return();l.setCatchFinallyBlocks(8);return l.yield(fetch(API_BASE_URL+
"/history",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+currentToken},body:JSON.stringify({originalText:f,plantumlCode:d,title:g,isFavorite:!0})}),10)}a=!currentIsFavorite;l.setCatchFinallyBlocks(4);return l.yield(fetch(API_BASE_URL+"/history/"+currentHistoryId+"/favorite",{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer "+currentToken},body:JSON.stringify({isFavorite:a})}),6);case 6:return b=l.yieldResult,l.yield(b.json(),7);case 7:c=
l.yieldResult;c.success?(currentIsFavorite=a,updateFavoriteButton(),showToast(a?"\u5df2\u6536\u85cf":"\u5df2\u53d6\u6d88\u6536\u85cf","success")):showToast(c.message||"\u64cd\u4f5c\u5931\u8d25","error");l.leaveTryBlock(0);break;case 4:e=l.enterCatchBlock();showToast("\u7f51\u7edc\u9519\u8bef\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5","error");console.error("Toggle current favorite error:",e);l.jumpTo(0);break;case 10:return h=l.yieldResult,l.yield(h.json(),11);case 11:k=l.yieldResult;k.success?(currentHistoryId=
k.id,currentIsFavorite=!0,updateFavoriteButton(),showToast("\u5df2\u6536\u85cf","success")):showToast(k.message||"\u6536\u85cf\u5931\u8d25","error");l.leaveTryBlock(0);break;case 8:m=l.enterCatchBlock(),showToast("\u7f51\u7edc\u9519\u8bef\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5","error"),console.error("Save and favorite error:",m),l.jumpToEnd()}})}
function updateFavoriteButton(){var a=document.getElementById("favoriteBtn"),b=document.getElementById("versionBtn"),c=a.querySelector("i");a.style.display="";currentHistoryId&&(b.style.display="");currentIsFavorite?(c.className="fas fa-star",a.title="\u53d6\u6d88\u6536\u85cf"):(c.className="far fa-star",a.title="\u6536\u85cf\u5f53\u524d\u56fe\u8868")}
function deleteHistory(a){var b,c,e;return $jscomp.asyncExecutePromiseGeneratorProgram(function(d){switch(d.nextAddress){case 1:if(!confirm("\u786e\u5b9a\u8981\u5220\u9664\u8fd9\u6761\u8bb0\u5f55\u5417\uff1f"))return d.return();d.setCatchFinallyBlocks(2);return d.yield(fetch(API_BASE_URL+"/history/"+a,{method:"DELETE",headers:{Authorization:"Bearer "+currentToken}}),4);case 4:return b=d.yieldResult,d.yield(b.json(),5);case 5:c=d.yieldResult;c.success?(showToast("\u5220\u9664\u6210\u529f","success"),
loadHistory(currentPage)):showToast(c.message||"\u5220\u9664\u5931\u8d25","error");d.leaveTryBlock(0);break;case 2:e=d.enterCatchBlock(),showToast("\u7f51\u7edc\u9519\u8bef\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5","error"),console.error("Delete history error:",e),d.jumpToEnd()}})}
function loadFavorites(){var a,b,c,e,d,f,g;return $jscomp.asyncExecutePromiseGeneratorProgram(function(h){switch(h.nextAddress){case 1:return h.setCatchFinallyBlocks(2),h.yield(fetch(API_BASE_URL+"/history/favorites",{headers:{Authorization:"Bearer "+currentToken}}),4);case 4:return a=h.yieldResult,h.yield(a.json(),5);case 5:b=h.yieldResult;if(b.success){c=document.getElementById("favoritesList");if(0===b.data.length)return c.innerHTML='\x3cp style\x3d"text-align: center; color: var(--text-muted); grid-column: 1/-1;"\x3e\u6682\u65e0\u6536\u85cf\x3c/p\x3e',
h.return();c.innerHTML=b.data.map(function(k){var m=escapeHtml(k.title||"\u672a\u547d\u540d\u56fe\u8868"),l=escapeHtml(k.originalText||""),q=formatDate(k.createdAt);return'\n                    \x3cdiv class\x3d"history-card" onclick\x3d"loadHistoryItem('+k.id+')"\x3e\n                        \x3cdiv class\x3d"history-card-header"\x3e\n                            \x3cdiv\x3e\n                                \x3cdiv class\x3d"history-card-title"\x3e'+m+'\x3c/div\x3e\n                                \x3cdiv class\x3d"history-card-date"\x3e'+
q+'\x3c/div\x3e\n                            \x3c/div\x3e\n                            \x3cdiv class\x3d"history-card-actions"\x3e\n                                \x3cbutton onclick\x3d"event.stopPropagation(); toggleFavorite('+k.id+', false)" title\x3d"\u53d6\u6d88\u6536\u85cf"\x3e\n                                    \x3ci class\x3d"fas fa-star"\x3e\x3c/i\x3e\n                                \x3c/button\x3e\n                            \x3c/div\x3e\n                        \x3c/div\x3e\n                        \x3cdiv class\x3d"history-card-description"\x3e'+
l+'\x3c/div\x3e\n                        \x3cdiv class\x3d"history-card-preview"\x3e\n                            \x3cdiv class\x3d"loading-spinner" data-id\x3d"'+k.id+'"\x3e\u52a0\u8f7d\u4e2d...\x3c/div\x3e\n                        \x3c/div\x3e\n                    \x3c/div\x3e\n                '}).join("");e={};d=$jscomp.makeIterator(b.data);for(f=d.next();!f.done;e={$jscomp$loop$prop$history$9$15:e.$jscomp$loop$prop$history$9$15},f=d.next())e.$jscomp$loop$prop$history$9$15=f.value,encodePlantUML(e.$jscomp$loop$prop$history$9$15.plantumlCode).then(function(k){return function(m){var l=
document.querySelector('.loading-spinner[data-id\x3d"'+k.$jscomp$loop$prop$history$9$15.id+'"]');l&&l.parentElement&&(l.parentElement.innerHTML='\x3cimg src\x3d"'+window.location.origin+"/plantuml/svg/"+m+'" alt\x3d"Preview" onerror\x3d"this.parentElement.innerHTML\x3d\'\x3cdiv style\x3d\\\'text-align:center;color:#999;\\\'\x3e\u9884\u89c8\u5931\u8d25\x3c/div\x3e\'"\x3e')}}(e)).catch(function(k){return function(m){console.error("Failed to encode PlantUML for favorite",k.$jscomp$loop$prop$history$9$15.id,
m);(m=document.querySelector('.loading-spinner[data-id\x3d"'+k.$jscomp$loop$prop$history$9$15.id+'"]'))&&m.parentElement&&(m.parentElement.innerHTML='\x3cdiv style\x3d"text-align:center;color:#999;"\x3e\u9884\u89c8\u5931\u8d25\x3c/div\x3e')}}(e))}else showToast(b.message||"\u52a0\u8f7d\u5931\u8d25","error");h.leaveTryBlock(0);break;case 2:g=h.enterCatchBlock(),showToast("\u7f51\u7edc\u9519\u8bef\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5","error"),console.error("Load favorites error:",g),h.jumpToEnd()}})}
function escapeHtml(a){if(!a)return"";var b=document.createElement("div");b.textContent=a;return b.innerHTML}
function encodePlantUML(a){var b,c,e;return $jscomp.asyncExecutePromiseGeneratorProgram(function(d){switch(d.nextAddress){case 1:if(!a)return d.return("");d.setCatchFinallyBlocks(2);return d.yield(fetch(window.location.origin+"/plantuml/coder",{method:"POST",headers:{"Content-Type":"text/plain"},body:a}),4);case 4:b=d.yieldResult;if(!b.ok){d.jumpTo(5);break}return d.yield(b.text(),6);case 6:return c=d.yieldResult,d.return(c);case 5:d.leaveTryBlock(3);break;case 2:e=d.enterCatchBlock(),console.error("Error encoding PlantUML:",
e);case 3:return d.return(encodeURIComponent(a))}})}function formatDate(a){a=new Date(a);var b=new Date-a;return 6E4>b?"\u521a\u521a":36E5>b?Math.floor(b/6E4)+"\u5206\u949f\u524d":864E5>b?Math.floor(b/36E5)+"\u5c0f\u65f6\u524d":6048E5>b?Math.floor(b/864E5)+"\u5929\u524d":a.toLocaleDateString("zh-CN")}var currentZoom=1,isDragging=!1,startX=0,startY=0,scrollLeft=0,scrollTop=0;
function openFullscreenPreview(){var a=document.getElementById("previewContainer").querySelector("img");if(a){var b=document.getElementById("fullscreenPreviewModal"),c=document.getElementById("fullscreenPreviewContainer");a=a.cloneNode(!0);a.style.transform="scale(1)";currentZoom=1;c.innerHTML="";c.appendChild(a);b.style.display="flex";setupImageDrag(c);document.addEventListener("keydown",handleEscKey)}else showToast("\u6ca1\u6709\u53ef\u9884\u89c8\u7684\u56fe\u7247","warning")}
function closeFullscreenPreview(){document.getElementById("fullscreenPreviewModal").style.display="none";currentZoom=1;document.removeEventListener("keydown",handleEscKey)}function handleEscKey(a){"Escape"===a.key&&closeFullscreenPreview()}
function zoomPreview(a){var b=document.getElementById("fullscreenPreviewContainer").querySelector("img");b&&("in"===a?currentZoom=Math.min(currentZoom+.2,5):"out"===a?currentZoom=Math.max(currentZoom-.2,.5):"reset"===a&&(currentZoom=1),b.style.transform="scale("+currentZoom+")",b.classList.toggle("zoomed",1<currentZoom))}
function setupImageDrag(a){a.addEventListener("mousedown",function(b){"IMG"===b.target.tagName&&1<currentZoom&&(isDragging=!0,startX=b.pageX-a.offsetLeft,startY=b.pageY-a.offsetTop,scrollLeft=a.scrollLeft,scrollTop=a.scrollTop,a.style.cursor="grabbing",b.preventDefault())});a.addEventListener("mouseleave",function(){isDragging=!1;a.style.cursor="default"});a.addEventListener("mouseup",function(){isDragging=!1;a.querySelector("img")&&1<currentZoom?a.style.cursor="grab":a.style.cursor="default"});a.addEventListener("mousemove",
function(b){if(isDragging){b.preventDefault();var c=2*(b.pageY-a.offsetTop-startY);a.scrollLeft=scrollLeft-2*(b.pageX-a.offsetLeft-startX);a.scrollTop=scrollTop-c}});a.addEventListener("wheel",function(b){if(b.ctrlKey||b.metaKey)b.preventDefault(),0>b.deltaY?zoomPreview("in"):zoomPreview("out")},{passive:!1})}
var $jscomp$destructuring$var17=function(){var a=function(){var c=[];return{suppressNextMessage:function(e,d){c.push({sender:e,condition:d})},isMessageSuppressed:function(e){for(var d=0;d<c.length;d++){var f=c[d];if(!f.sender||f.sender===e.sender)if(!f.condition||f.condition(e))return c.splice(d,1),!0}return!1}}}(),b=a.isMessageSuppressed;return{sendMessage:function(c){b(c)||(new BroadcastChannel("plantuml-server")).postMessage(c)},suppressNextMessage:a.suppressNextMessage,initAppCommunication:function(){(new BroadcastChannel("plantuml-server")).onmessage=
function(c){function e(h){var k,m,l,q,n,p;return $jscomp.asyncExecutePromiseGeneratorProgram(function(r){if(1==r.nextAddress)return document.appConfig.autoRefreshState="syncing",k=document.appData.encodedDiagram,m=document.appData.index,"url"!==h&&document.getElementById("url")&&setUrlValue(void 0,{encodedDiagram:k,index:m},{suppressEditorChangedMessage:!0}),r.yield(setDiagram(document.appConfig.diagramPreviewType,k,m),2);l=$jscomp.makeIterator(document.getElementsByClassName("diagram-link"));for(q=
l.next();!q.done;q=l.next())n=q.value,n.href=buildUrl(n.dataset.imgType,k,m);p=replaceUrl(window.location.href,k,m).url;history.replaceState(history.stat,document.title,p);document.appConfig.autoRefreshState="complete";r.jumpToEnd()})}var d,f,g;return $jscomp.asyncExecutePromiseGeneratorProgram(function(h){if(1==h.nextAddress){d=c.data.data;f=c.data.force||!1;if(d&&0!==Object.keys(d).length){var k={};"encodedDiagram"in d&&d.encodedDiagram!==document.appData.encodedDiagram&&(document.appData.encodedDiagram=
d.encodedDiagram,k.diagram=!0);"index"in d&&d.index!==document.appData.index&&(document.appData.index=d.index,k.index=!0);"numberOfDiagramPages"in d&&d.numberOfDiagramPages!==document.appData.numberOfDiagramPages&&(document.appData.numberOfDiagramPages=d.numberOfDiagramPages,k.numberOfDiagramPages=!0);"appConfig"in d&&d.appConfig!==document.appConfig&&(document.appConfig=d.appConfig,k.appConfig=!0)}else k={};g=k;return!0!==c.data.synchronize?h.jumpTo(2):f||g.diagram||g.index||g.appConfig?h.yield(e(c.data.sender),
3):h.jumpTo(3)}2!=h.nextAddress&&((f||g.numberOfDiagramPages)&&updatePaginator(),(f||g.numberOfDiagramPages||g.index)&&updatePaginatorSelection(),g.appConfig&&applyConfig());!0===c.data.reload&&window.location.reload();h.jumpToEnd()})}}}}(),sendMessage=$jscomp$destructuring$var17.sendMessage,suppressNextMessage=$jscomp$destructuring$var17.suppressNextMessage,initAppCommunication=$jscomp$destructuring$var17.initAppCommunication;
function makeRequest(a,b,c){c=void 0===c?{}:c;return PlantUmlLanguageFeatures.makeRequest(a,b,{data:void 0===c.data?null:c.data,headers:void 0===c.headers?{"Content-Type":"text/plain"}:c.headers,responseType:void 0===c.responseType?"text":c.responseType,baseUrl:void 0===c.baseUrl?"":c.baseUrl})}
var $jscomp$destructuring$var21=function(){var a={changeEventsEnabled:!0,autoRefreshState:"disabled",theme:void 0,diagramPreviewType:"png",editorWatcherTimeout:500,editorCreateOptions:{automaticLayout:!0,fixedOverflowWidgets:!0,minimap:{enabled:!1},scrollbar:{alwaysConsumeMouseWheel:!1},scrollBeyondLastLine:!1,tabSize:2,theme:"vs"}},b;document.appConfig=Object.assign({},null==(b=window.opener)?void 0:b.document.appConfig);0===Object.keys(document.appConfig).length&&(document.appConfig=JSON.parse(localStorage.getItem("document.appConfig"))||
a);return{applyConfig:function(){setTheme(document.appConfig.theme);var c;null==(c=document.editor)||c.updateOptions(document.appConfig.editorCreateOptions);var e;null==(e=document.settingsEditor)||e.updateOptions(document.appConfig.editorCreateOptions)},updateConfig:function(c){localStorage.setItem("document.appConfig",JSON.stringify(c));sendMessage({sender:"config",data:{appConfig:c},synchronize:!0})}}}(),applyConfig=$jscomp$destructuring$var21.applyConfig,updateConfig=$jscomp$destructuring$var21.updateConfig;
function removeChildren(a){a.replaceChildren?a.replaceChildren():a.innerHTML=""}function isVisible(a){return null!==a.offsetParent}function setVisibility(a,b,c){c=void 0===c?!1:c;b?(a.style.removeProperty("display"),c&&a.focus()):a.style.display="none"}var isMac=function(){var a,b,c;return((null==(a=navigator)?void 0:null==(b=a.userAgentData)?void 0:b.platform)||(null==(c=navigator)?void 0:c.platform)||"unknown").match("Mac")}();
function setTheme(a){document.documentElement.setAttribute("data-theme",a)}
function initTheme(){function a(e){"dark"===e&&"vs"===document.appConfig.editorCreateOptions.theme&&(document.appConfig.editorCreateOptions.theme="vs-dark");"light"===e&&"vs-dark"===document.appConfig.editorCreateOptions.theme&&(document.appConfig.editorCreateOptions.theme="vs")}var b=document.appConfig,c;(c=document.appConfig.theme)||(c=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":window.matchMedia("(prefers-color-scheme: light)").matches?"light":void 0);b.theme=c||"light";setTheme(document.appConfig.theme);
a(document.appConfig.theme);window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",function(e){e=e.matches?"dark":"light";document.appConfig.theme=e;a(e);updateConfig(document.appConfig)})}function resolvePath(a){return PlantUmlLanguageFeatures.absolutePath(a)}
function prepareUrl(a){a instanceof URL||(a=new URL(resolvePath(a)));var b=(new URL((document.querySelector("base")||{}).href||window.location.origin)).pathname;"/"===b.slice(-1)&&(b=b.slice(0,-1));b=a.pathname.startsWith(b)?a.pathname.slice(b.length):a.pathname;var c=/\/\w+(?:\/(\d+))?(?:\/([^/]+))?\/?$/gm.exec(b);return[a,b,{idx:c[1],encoded:c[2]}]}
function analyseUrl(a){var b=$jscomp.makeIterator(prepareUrl(a));a=b.next().value;b.next();b=b.next().value;return{index:b.idx,encodedDiagram:b.encoded||a.searchParams.get("url")}}
function replaceUrl(a,b,c){var e=$jscomp.makeIterator(prepareUrl(a));a=e.next().value;var d=e.next().value;e=e.next().value.encoded;var f=d.slice(1);f=f.slice(0,f.indexOf("/"));c&&0<=c&&(f+="/"+c);e&&(f+="/"+b);"/"===d.slice(-1)&&(f+="/");a.pathname=(new URL(resolvePath(f))).pathname;a.searchParams.get("url")&&a.searchParams.set("url",b);return{url:a,pathname:f}}function buildUrl(a,b,c){c&&0<=c&&(a+="/"+c);return a+("/"+b)};