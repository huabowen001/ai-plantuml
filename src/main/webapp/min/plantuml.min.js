'use strict';var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.createTemplateTagFirstArg=function(a){return a.raw=a};$jscomp.createTemplateTagFirstArgWithRaw=function(a,b){a.raw=b;return a};$jscomp.arrayIteratorImpl=function(a){var b=0;return function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}}};$jscomp.arrayIterator=function(a){return{next:$jscomp.arrayIteratorImpl(a)}};
$jscomp.makeIterator=function(a){var b="undefined"!=typeof Symbol&&Symbol.iterator&&a[Symbol.iterator];if(b)return b.call(a);if("number"==typeof a.length)return $jscomp.arrayIterator(a);throw Error(String(a)+" is not an iterable or ArrayLike");};$jscomp.arrayFromIterator=function(a){for(var b,c=[];!(b=a.next()).done;)c.push(b.value);return c};$jscomp.arrayFromIterable=function(a){return a instanceof Array?a:$jscomp.arrayFromIterator($jscomp.makeIterator(a))};
$jscomp.owns=function(a,b){return Object.prototype.hasOwnProperty.call(a,b)};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.ISOLATE_POLYFILLS=!1;$jscomp.FORCE_POLYFILL_PROMISE=!1;$jscomp.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){if(a==Array.prototype||a==Object.prototype)return a;a[b]=c.value;return a};$jscomp.getGlobal=function(a){a=["object"==typeof globalThis&&globalThis,a,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var b=0;b<a.length;++b){var c=a[b];if(c&&c.Math==Math)return c}throw Error("Cannot find global object");};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.IS_SYMBOL_NATIVE="function"===typeof Symbol&&"symbol"===typeof Symbol("x");$jscomp.TRUST_ES6_POLYFILLS=!$jscomp.ISOLATE_POLYFILLS||$jscomp.IS_SYMBOL_NATIVE;$jscomp.polyfills={};$jscomp.propertyToPolyfillSymbol={};$jscomp.POLYFILL_PREFIX="$jscp$";var $jscomp$lookupPolyfilledValue=function(a,b,c){if(!c||null!=a){c=$jscomp.propertyToPolyfillSymbol[b];if(null==c)return a[b];c=a[c];return void 0!==c?c:a[b]}};
$jscomp.polyfill=function(a,b,c,d){b&&($jscomp.ISOLATE_POLYFILLS?$jscomp.polyfillIsolated(a,b,c,d):$jscomp.polyfillUnisolated(a,b,c,d))};$jscomp.polyfillUnisolated=function(a,b,c,d){c=$jscomp.global;a=a.split(".");for(d=0;d<a.length-1;d++){var e=a[d];if(!(e in c))return;c=c[e]}a=a[a.length-1];d=c[a];b=b(d);b!=d&&null!=b&&$jscomp.defineProperty(c,a,{configurable:!0,writable:!0,value:b})};
$jscomp.polyfillIsolated=function(a,b,c,d){var e=a.split(".");a=1===e.length;d=e[0];d=!a&&d in $jscomp.polyfills?$jscomp.polyfills:$jscomp.global;for(var f=0;f<e.length-1;f++){var g=e[f];if(!(g in d))return;d=d[g]}e=e[e.length-1];c=$jscomp.IS_SYMBOL_NATIVE&&"es6"===c?d[e]:null;b=b(c);null!=b&&(a?$jscomp.defineProperty($jscomp.polyfills,e,{configurable:!0,writable:!0,value:b}):b!==c&&(void 0===$jscomp.propertyToPolyfillSymbol[e]&&(c=1E9*Math.random()>>>0,$jscomp.propertyToPolyfillSymbol[e]=$jscomp.IS_SYMBOL_NATIVE?
$jscomp.global.Symbol(e):$jscomp.POLYFILL_PREFIX+c+"$"+e),$jscomp.defineProperty(d,$jscomp.propertyToPolyfillSymbol[e],{configurable:!0,writable:!0,value:b})))};$jscomp.assign=$jscomp.TRUST_ES6_POLYFILLS&&"function"==typeof Object.assign?Object.assign:function(a,b){for(var c=1;c<arguments.length;c++){var d=arguments[c];if(d)for(var e in d)$jscomp.owns(d,e)&&(a[e]=d[e])}return a};$jscomp.polyfill("Object.assign",function(a){return a||$jscomp.assign},"es6","es3");
$jscomp.underscoreProtoCanBeSet=function(){var a={a:!0},b={};try{return b.__proto__=a,b.a}catch(c){}return!1};$jscomp.setPrototypeOf=$jscomp.TRUST_ES6_POLYFILLS&&"function"==typeof Object.setPrototypeOf?Object.setPrototypeOf:$jscomp.underscoreProtoCanBeSet()?function(a,b){a.__proto__=b;if(a.__proto__!==b)throw new TypeError(a+" is not extensible");return a}:null;$jscomp.generator={};
$jscomp.generator.ensureIteratorResultIsObject_=function(a){if(!(a instanceof Object))throw new TypeError("Iterator result "+a+" is not an object");};$jscomp.generator.Context=function(){this.isRunning_=!1;this.yieldAllIterator_=null;this.yieldResult=void 0;this.nextAddress=1;this.finallyAddress_=this.catchAddress_=0;this.finallyContexts_=this.abruptCompletion_=null};
$jscomp.generator.Context.prototype.start_=function(){if(this.isRunning_)throw new TypeError("Generator is already running");this.isRunning_=!0};$jscomp.generator.Context.prototype.stop_=function(){this.isRunning_=!1};$jscomp.generator.Context.prototype.jumpToErrorHandler_=function(){this.nextAddress=this.catchAddress_||this.finallyAddress_};$jscomp.generator.Context.prototype.next_=function(a){this.yieldResult=a};
$jscomp.generator.Context.prototype.throw_=function(a){this.abruptCompletion_={exception:a,isException:!0};this.jumpToErrorHandler_()};$jscomp.generator.Context.prototype.return=function(a){this.abruptCompletion_={return:a};this.nextAddress=this.finallyAddress_};$jscomp.generator.Context.prototype.jumpThroughFinallyBlocks=function(a){this.abruptCompletion_={jumpTo:a};this.nextAddress=this.finallyAddress_};$jscomp.generator.Context.prototype.yield=function(a,b){this.nextAddress=b;return{value:a}};
$jscomp.generator.Context.prototype.yieldAll=function(a,b){a=$jscomp.makeIterator(a);var c=a.next();$jscomp.generator.ensureIteratorResultIsObject_(c);if(c.done)this.yieldResult=c.value,this.nextAddress=b;else return this.yieldAllIterator_=a,this.yield(c.value,b)};$jscomp.generator.Context.prototype.jumpTo=function(a){this.nextAddress=a};$jscomp.generator.Context.prototype.jumpToEnd=function(){this.nextAddress=0};
$jscomp.generator.Context.prototype.setCatchFinallyBlocks=function(a,b){this.catchAddress_=a;void 0!=b&&(this.finallyAddress_=b)};$jscomp.generator.Context.prototype.setFinallyBlock=function(a){this.catchAddress_=0;this.finallyAddress_=a||0};$jscomp.generator.Context.prototype.leaveTryBlock=function(a,b){this.nextAddress=a;this.catchAddress_=b||0};
$jscomp.generator.Context.prototype.enterCatchBlock=function(a){this.catchAddress_=a||0;a=this.abruptCompletion_.exception;this.abruptCompletion_=null;return a};$jscomp.generator.Context.prototype.enterFinallyBlock=function(a,b,c){c?this.finallyContexts_[c]=this.abruptCompletion_:this.finallyContexts_=[this.abruptCompletion_];this.catchAddress_=a||0;this.finallyAddress_=b||0};
$jscomp.generator.Context.prototype.leaveFinallyBlock=function(a,b){b=this.finallyContexts_.splice(b||0)[0];if(b=this.abruptCompletion_=this.abruptCompletion_||b){if(b.isException)return this.jumpToErrorHandler_();void 0!=b.jumpTo&&this.finallyAddress_<b.jumpTo?(this.nextAddress=b.jumpTo,this.abruptCompletion_=null):this.nextAddress=this.finallyAddress_}else this.nextAddress=a};$jscomp.generator.Context.prototype.forIn=function(a){return new $jscomp.generator.Context.PropertyIterator(a)};
$jscomp.generator.Context.PropertyIterator=function(a){this.object_=a;this.properties_=[];for(var b in a)this.properties_.push(b);this.properties_.reverse()};$jscomp.generator.Context.PropertyIterator.prototype.getNext=function(){for(;0<this.properties_.length;){var a=this.properties_.pop();if(a in this.object_)return a}return null};$jscomp.generator.Engine_=function(a){this.context_=new $jscomp.generator.Context;this.program_=a};
$jscomp.generator.Engine_.prototype.next_=function(a){this.context_.start_();if(this.context_.yieldAllIterator_)return this.yieldAllStep_(this.context_.yieldAllIterator_.next,a,this.context_.next_);this.context_.next_(a);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.return_=function(a){this.context_.start_();var b=this.context_.yieldAllIterator_;if(b)return this.yieldAllStep_("return"in b?b["return"]:function(c){return{value:c,done:!0}},a,this.context_.return);this.context_.return(a);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.throw_=function(a){this.context_.start_();if(this.context_.yieldAllIterator_)return this.yieldAllStep_(this.context_.yieldAllIterator_["throw"],a,this.context_.next_);this.context_.throw_(a);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.yieldAllStep_=function(a,b,c){try{var d=a.call(this.context_.yieldAllIterator_,b);$jscomp.generator.ensureIteratorResultIsObject_(d);if(!d.done)return this.context_.stop_(),d;var e=d.value}catch(f){return this.context_.yieldAllIterator_=null,this.context_.throw_(f),this.nextStep_()}this.context_.yieldAllIterator_=null;c.call(this.context_,e);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.nextStep_=function(){for(;this.context_.nextAddress;)try{var a=this.program_(this.context_);if(a)return this.context_.stop_(),{value:a.value,done:!1}}catch(b){this.context_.yieldResult=void 0,this.context_.throw_(b)}this.context_.stop_();if(this.context_.abruptCompletion_){a=this.context_.abruptCompletion_;this.context_.abruptCompletion_=null;if(a.isException)throw a.exception;return{value:a.return,done:!0}}return{value:void 0,done:!0}};
$jscomp.generator.Generator_=function(a){this.next=function(b){return a.next_(b)};this.throw=function(b){return a.throw_(b)};this.return=function(b){return a.return_(b)};this[Symbol.iterator]=function(){return this}};$jscomp.generator.createGenerator=function(a,b){b=new $jscomp.generator.Generator_(new $jscomp.generator.Engine_(b));$jscomp.setPrototypeOf&&a.prototype&&$jscomp.setPrototypeOf(b,a.prototype);return b};
$jscomp.asyncExecutePromiseGenerator=function(a){function b(d){return a.next(d)}function c(d){return a.throw(d)}return new Promise(function(d,e){function f(g){g.done?d(g.value):Promise.resolve(g.value).then(b,c).then(f,e)}f(a.next())})};$jscomp.asyncExecutePromiseGeneratorFunction=function(a){return $jscomp.asyncExecutePromiseGenerator(a())};$jscomp.asyncExecutePromiseGeneratorProgram=function(a){return $jscomp.asyncExecutePromiseGenerator(new $jscomp.generator.Generator_(new $jscomp.generator.Engine_(a)))};
$jscomp.getRestArguments=function(){for(var a=Number(this),b=[],c=a;c<arguments.length;c++)b[c-a]=arguments[c];return b};
function initApp(){var a,b;return $jscomp.asyncExecutePromiseGeneratorProgram(function(c){if(1==c.nextAddress)return b=null==(a=(new URL(window.location.href)).searchParams.get("view"))?void 0:a.toLowerCase(),c.yield(initEditor(b),2);if(3!=c.nextAddress){var d=analyseUrl(window.location.href),e,f=null==(e=document.editor)?void 0:e.getValue(),g;document.appData=Object.assign({},null==(g=window.opener)?void 0:g.document.appData);0===Object.keys(document.appData).length&&(document.appData={encodedDiagram:d.encodedDiagram,
index:d.index,numberOfDiagramPages:f?getNumberOfDiagramPagesFromCode(f):1});initTheme();initAppCommunication();return c.yield(initPreview(b),3)}initModals(b);document.editor&&(document.editor.focus(),"SyfFKj2rKt3CoKnELR1Io4ZDoSa70000"==document.appData.encodedDiagram&&document.editor.setSelection({startLineNumber:2,endLineNumber:2,startColumn:1,endColumn:21}));document.appConfig.autoRefreshState="complete";c.jumpToEnd()})}window.onload=initApp;
var $jscomp$destructuring$var0=function(){return{setEditorValue:function(a,b,c){c=void 0===c?{}:c;var d=void 0===c.forceMoveMarkers?void 0:c.forceMoveMarkers;(void 0===c.suppressEditorChangedMessage?0:c.suppressEditorChangedMessage)&&a===document.editor&&suppressNextMessage("editor");a.executeEdits("",[{range:a.getModel().getFullModelRange(),text:b,forceMoveMarkers:d}])},initEditor:function(a){function b(){return new Promise(function(g,l){require.config({paths:{vs:"webjars/monaco-editor/0.36.1/min/vs"}});
require(["vs/editor/editor.main"],g)})}function c(){function g(m,q,n){function p(){document.appConfig.autoRefreshState="started";var t=getNumberOfDiagramPagesFromCode(m),u=document.appData.index;void 0===u||1===t?u=void 0:u>=t&&(u=t-1);makeRequest("POST","coder",{data:m}).then(function(v){sendMessage({sender:q,data:{encodedDiagram:v,numberOfDiagramPages:t,index:u},synchronize:!0})})}n=void 0===n?!0:n;var r=function(){return function(){var t=document.editor.getModel();l=l||new PlantUmlLanguageFeatures;
l.validateCode(t).then(function(u){return monaco.editor.setModelMarkers(t,"plantuml",u)})}}();q&&n&&p();r()}var l,k=monaco.editor.createModel(function(){var m=document.getElementById("initCode"),q=m.value;m.remove();return q}(),"apex",monaco.Uri.parse("inmemory://plantuml")),h=0;k.onDidChangeContent(function(){clearTimeout(h);document.appConfig.autoRefreshState="waiting";h=setTimeout(function(){return g(k.getValue(),"editor")},document.appConfig.editorWatcherTimeout)});return k}function d(){return{get:function(){},
getBoolean:function(g){return"expandSuggestionDocs"===g},getNumber:function(){return 0},remove:function(){},store:function(){},onWillSaveState:function(){},onDidChangeStorage:function(){},onDidChangeValue:function(){}}}var e,f;return $jscomp.asyncExecutePromiseGeneratorProgram(function(g){if(1==g.nextAddress)return g.yield(b(),2);"previewer"!==a&&(e=c(),f=d(),document.editor=monaco.editor.create(document.getElementById("monaco-editor"),Object.assign({},{model:e},document.appConfig.editorCreateOptions),
{storageService:f}),document.addEventListener("resize",function(){return document.editor.layout()}),initEditorUrlInput(),initEditorMenu());g.jumpToEnd()})}}}(),setEditorValue=$jscomp$destructuring$var0.setEditorValue,initEditor=$jscomp$destructuring$var0.initEditor;
function initEditorMenu(){document.getElementById("menu-item-editor-code-copy").addEventListener("click",function(){var a=document.editor.getModel().getFullModelRange();document.editor.focus();document.editor.setSelection(a);a=document.editor.getValue();var b;null==(b=navigator.clipboard)||b.writeText(a).catch(function(){})})}
var $jscomp$destructuring$var3=function(){function a(b,c,d){var e=void 0===c?{}:c;c=void 0===e.encodedDiagram?void 0:e.encodedDiagram;e=void 0===e.index?void 0:e.index;d=void 0===d?{}:d;if(b||c)(void 0===d.suppressEditorChangedMessage?0:d.suppressEditorChangedMessage)&&suppressNextMessage("url"),document.getElementById("url").value=b?b:resolvePath(buildUrl("png",c,e))}return{setUrlValue:a,initEditorUrlInput:function(){var b=document.getElementById("url");a(resolvePath(b.value));b.addEventListener("change",
function(c){var d,e;return $jscomp.asyncExecutePromiseGeneratorProgram(function(f){if(1==f.nextAddress)return document.appConfig.autoRefreshState="started",c.target.title=c.target.value,d=analyseUrl(c.target.value),f.yield(makeRequest("GET","coder/"+d.encodedDiagram),2);e=f.yieldResult;setEditorValue(document.editor,e,{suppressEditorChangedMessage:!0});sendMessage({sender:"url",data:{encodedDiagram:d.encodedDiagram,index:d.index},synchronize:!0});f.jumpToEnd()})});document.getElementById("url-copy-btn").addEventListener("click",
function(){b.focus();b.select();var c;null==(c=navigator.clipboard)||c.writeText(b.value).catch(function(){})})}}}(),setUrlValue=$jscomp$destructuring$var3.setUrlValue,initEditorUrlInput=$jscomp$destructuring$var3.initEditorUrlInput;
function initDiagramExport(){function a(){setVisibility(document.getElementById("diagram-export"),!0,!0);var f=document.editor.getValue();f=Array.from(f.matchAll(/^\s*@start[a-zA-Z]*\s+([a-zA-Z-_\u00e4\u00f6\u00fc\u00c4\u00d6\u00dc\u00df ]+)\s*$/gm),function(g){return g[1]})[0]||"diagram";d.value=f+".puml";e.value="code";d.focus()}function b(f){var g=f.lastIndexOf(".");return 1>g?{name:f,ext:null}:g===f.length-1?{name:f.slice(0,-1),ext:null}:{name:f.substring(0,g),ext:f.substring(g+1)}}function c(f){if(!f)return f;
f=f.toLowerCase();switch(f){case "puml":case "plantuml":case "code":return"code";case "ascii":return"txt";default:return f}}var d=document.getElementById("download-name"),e=document.getElementById("download-type");registerModalListener("diagram-export",a);d.addEventListener("change",function(f){f=b(f.target.value).ext;if(f=c(f))e.value=f});e.addEventListener("change",function(f){f=f.target.value;a:switch(f){case "epstext":f="eps";break a;case "code":f="puml"}var g=b(d.value).name;d.value=g+"."+f});
document.getElementById("diagram-export-ok-btn").addEventListener("click",function(){var f=d.value,g=e.value,l=document.createElement("a");l.download=f;"code"===g?(f=document.editor.getValue(),l.href="data:,"+encodeURIComponent(f)):l.href=void 0!==document.appData.index?g+"/"+document.appData.index+"/"+document.appData.encodedDiagram:g+"/"+document.appData.encodedDiagram;l.click()});window.addEventListener("keydown",function(f){"s"===f.key&&(isMac?f.metaKey:f.ctrlKey)&&(f.preventDefault(),isModalOpen("diagram-export")||
a())},!1)}
function initDiagramImport(){function a(h){h=void 0===h?!0:h;setVisibility(f,!0,!0);f.dataset.isOpenManually=h.toString();g.value="";c(g)}function b(){g.value="";c(g);f.removeAttribute("data-is-open-manually");setVisibility(f,!1)}function c(h){k.innerText="";var m;l.disabled=1>(null==(m=h.files)?void 0:m.length)}function d(h){function m(n){var p=n.name,r=n.type;n=["plain","text","plantuml","puml"];if(0<n.filter(function(u){return-1!==r.toLowerCase().indexOf(u)}).length)return!0;if(-1===p.indexOf("."))return!1;
var t=p.substring(p.lastIndexOf(".")+1).toLowerCase();n=["txt","puml","plantuml"];return 0<n.filter(function(u){return t===u}).length}var q=function(n){var p=n.name,r=n.type;n=["png","svg"];var t=n.filter(function(v){return-1!==r.toLowerCase().indexOf(v)})[0];if(t)return t;if(-1!==p.indexOf(".")){var u=p.substring(p.lastIndexOf(".")+1).toLowerCase();return n.filter(function(v){return u===v})[0]}}(h);h=void 0===q?m(h):!1;q||h||(k.innerText="File not supported. Only PNG and SVG diagram images as well as PlantUML code text files are supported.");
return{type:q,isDiagramCode:h,valid:q||h}}function e(h,m){function q(n){var p=new FormData;p.append("diagram",n,n.name);return makeRequest("POST","metadata",{data:p,responseType:"json",headers:{Accept:"application/json"}})}f.classList.add("wait");return(new Promise(function(n,p){if(m.type)q(h).then(function(t){setEditorValue(document.editor,t.decoded);n()},function(t){t=t.response;k.innerText=t.message||t;p()});else if(m.isDiagramCode){var r=new FileReader;r.onload=function(t){setEditorValue(document.editor,
t.target.result)};r.readAsText(h);n()}else k.innerText="File not supported. Only PNG and SVG diagram images as well as PlantUML code text files are supported.",p()})).then(function(){return b()},function(){}).finally(function(){return f.classList.remove("wait")})}var f=document.getElementById("diagram-import"),g=document.getElementById("diagram-import-input"),l=document.getElementById("diagram-import-ok-btn"),k=document.getElementById("diagram-import-error-message");window.addEventListener("dragenter",
function(h){h.stopPropagation();h.preventDefault();isVisible(f)||a(!1)},!1);g.addEventListener("dragenter",function(h){return h.target.classList.add("drop-able")},!1);g.addEventListener("dragover",function(h){h.stopPropagation();h.preventDefault();null!==h.dataTransfer&&(h.dataTransfer.dropEffect="copy")},!1);g.addEventListener("dragexit",function(h){return h.target.classList.remove("drop-able")},!1);g.addEventListener("drop",function(h){function m(){h.stopPropagation();h.preventDefault()}var q=h.dataTransfer.files||
h.target.files;if(!q||1>q.length)return m();q=q[0];var n=d(q);if(!n.valid)return m();"true"!==f.dataset.isOpenManually&&(m(),e(q,n))},!1);g.addEventListener("change",function(h){return c(h.target)});l.addEventListener("click",function(){var h=g.files[0];e(h,d(h))});registerModalListener("diagram-import",a,b)}var WECHAT_ID="hualinyuezhao",WECHAT_PAY_QR_CODE="assets/wechat-pay.png";
function initDonate(){var a=document.getElementById("wechat-id-text");a&&(a.textContent=WECHAT_ID);loadWechatQRCode()}function loadWechatQRCode(){var a=document.getElementById("wechat-qrcode");if(a){var b=new Image;b.src=WECHAT_PAY_QR_CODE;b.onload=function(){a.innerHTML="";a.appendChild(b)};b.onerror=function(){console.log("\u5fae\u4fe1\u6536\u6b3e\u7801\u56fe\u7247\u672a\u627e\u5230\uff0c\u663e\u793a\u5360\u4f4d\u7b26")}}}
function copyWechatId(){var a=document.getElementById("wechat-id-text").textContent;navigator.clipboard&&navigator.clipboard.writeText?navigator.clipboard.writeText(a).then(function(){showCopySuccess()}).catch(function(b){console.error("\u590d\u5236\u5931\u8d25:",b);fallbackCopyTextToClipboard(a)}):fallbackCopyTextToClipboard(a)}
function fallbackCopyTextToClipboard(a){var b=document.createElement("textarea");b.value=a;b.style.position="fixed";b.style.top="0";b.style.left="0";b.style.width="2em";b.style.height="2em";b.style.padding="0";b.style.border="none";b.style.outline="none";b.style.boxShadow="none";b.style.background="transparent";document.body.appendChild(b);b.focus();b.select();try{document.execCommand("copy")?showCopySuccess():alert("\u590d\u5236\u5931\u8d25\uff0c\u8bf7\u624b\u52a8\u590d\u5236\u5fae\u4fe1\u53f7")}catch(c){console.error("\u590d\u5236\u5931\u8d25:",
c),alert("\u590d\u5236\u5931\u8d25\uff0c\u8bf7\u624b\u52a8\u590d\u5236\u5fae\u4fe1\u53f7")}document.body.removeChild(b)}function showCopySuccess(){var a=document.querySelector(".donate-modal .copy-btn");if(a){var b=a.textContent;a.textContent="\u5df2\u590d\u5236!";a.style.backgroundColor="#07C160";a.style.color="white";setTimeout(function(){a.textContent=b;a.style.backgroundColor="";a.style.color=""},2E3)}}
var $jscomp$destructuring$var16=function(){var a={};return{registerModalListener:function(b,c,d){a[b]={fnOpen:c,fnClose:d}},openModal:function(b){var c=$jscomp.getRestArguments.apply(1,arguments),d,e=null==(d=a[b])?void 0:d.fnOpen;e?e.apply(null,$jscomp.arrayFromIterable(c)):setVisibility(document.getElementById(b),!0,!0)},closeModal:function(b){var c=$jscomp.getRestArguments.apply(1,arguments),d,e=null==(d=a[b])?void 0:d.fnClose;e?e.apply(null,$jscomp.arrayFromIterable(c)):setVisibility(document.getElementById(b),
!1)}}}(),registerModalListener=$jscomp$destructuring$var16.registerModalListener,openModal=$jscomp$destructuring$var16.openModal,closeModal=$jscomp$destructuring$var16.closeModal;
function initModals(a){function b(c){"Escape"===c.key||"Esc"===c.key?(c.preventDefault(),closeModal(c.target.closest(".modal").id)):"Enter"===c.key&&(c.preventDefault(),(c=c.target.closest(".modal").querySelector('input.ok[type\x3d"button"]'))&&!c.disabled&&c.click())}document.querySelectorAll(".modal").forEach(function(c){c.addEventListener("keydown",b,!1)});initSettings();initDonate();"previewer"!==a&&(initDiagramExport(),initDiagramImport())}
function isModalOpen(a){return isVisible(document.getElementById(a))}function closeAllModals(){document.querySelectorAll(".modal").forEach(function(a){return closeModal(a.id)})}
function initSettings(){function a(){setVisibility(document.getElementById("settings"),!0,!0);b.value=document.appConfig.theme;c.value=document.appConfig.diagramPreviewType;d.value=document.appConfig.editorWatcherTimeout;setEditorValue(document.settingsEditor,JSON.stringify(document.appConfig.editorCreateOptions,null,"  "))}var b=document.getElementById("theme"),c=document.getElementById("diagramPreviewType"),d=document.getElementById("editorWatcherTimeout");document.settingsEditor=monaco.editor.create(document.getElementById("settings-monaco-editor"),
Object.assign({},{language:"json"},document.appConfig.editorCreateOptions));b.addEventListener("change",function(e){e=e.target.value;var f=document.settingsEditor.getValue();setEditorValue(document.settingsEditor,f.replace(new RegExp('("theme"\\s*:\\s*)"'+("dark"===e?"vs":"vs-dark")+'"',"gm"),'$1"'+("dark"===e?"vs-dark":"vs")+'"'))});document.getElementById("settings-ok-btn").addEventListener("click",function(){var e=Object.assign({},document.appConfig);e.theme=b.value;e.editorWatcherTimeout=d.value;
e.diagramPreviewType=c.value;e.editorCreateOptions=JSON.parse(document.settingsEditor.getValue());updateConfig(e);closeModal("settings")});window.addEventListener("keydown",function(e){","===e.key&&(isMac?e.metaKey:e.ctrlKey)&&(e.preventDefault(),isModalOpen("settings")||a())},!1);registerModalListener("settings",a)}
function initializeDiagram(){return $jscomp.asyncExecutePromiseGeneratorProgram(function(a){if("png"!==document.appConfig.diagramPreviewType)return a.return(setDiagram(document.appConfig.diagramPreviewType,document.appData.encodedDiagram,document.appData.index));a.jumpToEnd()})}
function setDiagram(a,b,c){function d(n,p,r){return $jscomp.asyncExecutePromiseGeneratorProgram(function(t){return t.return(makeRequest("GET",buildUrl(n,p,r)))})}var e,f,g,l,k,h,m,q;return $jscomp.asyncExecutePromiseGeneratorProgram(function(n){switch(n.nextAddress){case 1:e=document.getElementById("diagram");f=document.getElementById("diagram-png");g=document.getElementById("diagram-txt");l=document.getElementById("diagram-pdf");n.setCatchFinallyBlocks(2);if("png"===a)return f.src=buildUrl("png",
b,c),n.yield(d("map",b,c),11);if("svg"===a)return n.yield(d("svg",b,c),10);if("txt"!==a){if("pdf"===a)l.data=buildUrl("pdf",b,c);else return k="unknown diagram type: "+a,(console.error||console.log)(k),n.return(Promise.reject(k));n.jumpTo(5);break}h=g;return n.yield(d("txt",b,c),9);case 9:h.innerHTML=n.yieldResult;n.jumpTo(5);break;case 10:m=n.yieldResult;var p=document.getElementById("diagram-svg"),r=document.createElement("div");r.innerHTML=m;r=r.querySelector("svg");r.id="diagram-svg";r.classList=
p.classList;r.style.cssText=p.style.cssText;p.parentNode.replaceChild(r,p);n.jumpTo(5);break;case 11:if(q=n.yieldResult,p=document.getElementById("plantuml_map"),r=document.getElementById("map-diagram-link"),q){var t=document.createElement("div");t.innerHTML=q;p.parentNode.replaceChild(t.firstChild,p);setVisibility(r,!0)}else removeChildren(p),setVisibility(r,!1);case 5:p=document.getElementById("plantuml_map");r=document.getElementById("diagram-svg");e.setAttribute("data-diagram-type",a);setVisibility(f,
"png"===a);setVisibility(p,"png"===a);setVisibility(r,"svg"===a);setVisibility(g,"txt"===a);setVisibility(l,"pdf"===a);n.leaveTryBlock(0);break;case 2:n.enterCatchBlock(),n.jumpToEnd()}})}function getNumberOfDiagramPagesFromCode(a){var b;return(null==(b=a.match(/^\s*newpage\s?.*$/gm))?void 0:b.length)+1||1}
function updatePaginatorSelection(){var a=document.getElementById("paginator"),b=document.appData.index;if(void 0===b||a.childNodes.length<=b)for(a=$jscomp.makeIterator(a.childNodes),b=a.next();!b.done;b=a.next())b.value.checked=!1;else a.childNodes[b].checked=!0}
var updatePaginator=function(){function a(b,c){for(;b.childElementCount>c;)b.removeChild(b.lastChild);for(;b.childElementCount<c;){var d=document.createElement("input");d.name="paginator";d.type="radio";d.value=b.childElementCount;d.addEventListener("click",function(e){sendMessage({sender:"paginator",data:{index:e.target.value},synchronize:!0})});b.appendChild(d)}}return function(){var b=document.getElementById("paginator"),c=document.appData.numberOfDiagramPages;1<c?(a(b,c),setVisibility(b,!0)):
setVisibility(b,!1)}}();function initializePaginator(){1<document.appData.numberOfDiagramPages&&(updatePaginator(),updatePaginatorSelection())}
function initPreview(a){function b(){setVisibility(e,!1);setVisibility(f,window.opener);g&&(g.style.width="100%");l&&setVisibility(l,!1)}function c(){setVisibility(e,!0);setVisibility(f,!1);g&&g.style.removeProperty("width");l&&setVisibility(l,!0)}function d(){var k=new URL(window.location.href);k.searchParams.set("view","previewer");if(k=window.open(k,"PlantUML Diagram Previewer","popup"))k.onbeforeunload=c,b()}var e,f,g,l;return $jscomp.asyncExecutePromiseGeneratorProgram(function(k){if(1==k.nextAddress)return e=
document.getElementById("btn-undock"),f=document.getElementById("btn-dock"),g=document.getElementById("editor-main-container"),l=document.getElementById("previewer-main-container"),e.addEventListener("click",d),k.yield(initializeDiagram(),2);initializePaginator();["previewer","editor"].includes(a)&&b();k.jumpToEnd()})}var currentUser=null,currentToken=null,currentHistoryId=null,currentIsFavorite=!1,currentPage=1,pageSize=12,API_BASE_URL=window.location.origin+"/plantuml/api";
document.addEventListener("DOMContentLoaded",function(){var a=localStorage.getItem("authToken"),b=localStorage.getItem("currentUser");a&&b?(currentToken=a,currentUser=JSON.parse(b),showMainApp()):showAuthModal();setupModalEvents()});
function setupModalEvents(){var a=document.getElementById("authModal"),b=document.querySelector(".close"),c=document.querySelectorAll(".auth-tab");b&&(b.onclick=function(){currentToken&&(a.style.display="none")});c.forEach(function(d){d.addEventListener("click",function(){switchAuthTab(this.dataset.tab)})});document.getElementById("loginPassword").addEventListener("keypress",function(d){"Enter"===d.key&&handleLogin()});document.getElementById("registerPassword").addEventListener("keypress",function(d){"Enter"===
d.key&&handleRegister()})}function switchAuthTab(a){document.querySelectorAll(".auth-tab").forEach(function(b){return b.classList.remove("active")});document.querySelectorAll(".auth-form").forEach(function(b){return b.classList.remove("active")});document.querySelector('[data-tab\x3d"'+a+'"]').classList.add("active");document.getElementById(a+"Form").classList.add("active");document.querySelectorAll(".error-message").forEach(function(b){b.classList.remove("show");b.textContent=""})}
function showAuthModal(){document.getElementById("authModal").style.display="flex";document.getElementById("mainApp").style.display="none"}function showMainApp(){document.getElementById("authModal").style.display="none";document.getElementById("mainApp").style.display="block";currentUser&&(document.getElementById("userDisplayName").textContent=currentUser.fullName||currentUser.username);showSection("editor")}
function handleLogin(){var a,b,c,d,e,f;return $jscomp.asyncExecutePromiseGeneratorProgram(function(g){switch(g.nextAddress){case 1:a=document.getElementById("loginUsername").value.trim();b=document.getElementById("loginPassword").value;c=document.getElementById("loginError");if(!a||!b)return showError(c,"\u8bf7\u8f93\u5165\u7528\u6237\u540d\u548c\u5bc6\u7801"),g.return();g.setCatchFinallyBlocks(2);return g.yield(fetch(API_BASE_URL+"/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},
body:JSON.stringify({username:a,password:b})}),4);case 4:return d=g.yieldResult,g.yield(d.json(),5);case 5:e=g.yieldResult;e.success?(currentToken=e.token,currentUser=e.user,localStorage.setItem("authToken",currentToken),localStorage.setItem("currentUser",JSON.stringify(currentUser)),showToast("\u767b\u5f55\u6210\u529f\uff01","success"),showMainApp()):showError(c,e.message||"\u767b\u5f55\u5931\u8d25");g.leaveTryBlock(0);break;case 2:f=g.enterCatchBlock(),showError(c,"\u7f51\u7edc\u9519\u8bef\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5"),
console.error("Login error:",f),g.jumpToEnd()}})}
function handleRegister(){var a,b,c,d,e,f,g,l;return $jscomp.asyncExecutePromiseGeneratorProgram(function(k){switch(k.nextAddress){case 1:a=document.getElementById("registerUsername").value.trim();b=document.getElementById("registerEmail").value.trim();c=document.getElementById("registerPassword").value;d=document.getElementById("registerFullName").value.trim();e=document.getElementById("registerError");if(!a||!b||!c)return showError(e,"\u8bf7\u586b\u5199\u6240\u6709\u5fc5\u586b\u9879"),k.return();
if(6>c.length)return showError(e,"\u5bc6\u7801\u957f\u5ea6\u81f3\u5c11\u4e3a6\u4f4d"),k.return();k.setCatchFinallyBlocks(2);return k.yield(fetch(API_BASE_URL+"/auth/register",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:a,email:b,password:c,fullName:d})}),4);case 4:return f=k.yieldResult,k.yield(f.json(),5);case 5:g=k.yieldResult;g.success?(currentToken=g.token,currentUser=g.user,localStorage.setItem("authToken",currentToken),localStorage.setItem("currentUser",
JSON.stringify(currentUser)),showToast("\u6ce8\u518c\u6210\u529f\uff01","success"),showMainApp()):showError(e,g.message||"\u6ce8\u518c\u5931\u8d25");k.leaveTryBlock(0);break;case 2:l=k.enterCatchBlock(),showError(e,"\u7f51\u7edc\u9519\u8bef\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5"),console.error("Register error:",l),k.jumpToEnd()}})}
function handleLogout(){localStorage.removeItem("authToken");localStorage.removeItem("currentUser");currentUser=currentToken=null;showToast("\u5df2\u9000\u51fa\u767b\u5f55","success");showAuthModal()}function showError(a,b){a.textContent=b;a.classList.add("show");setTimeout(function(){a.classList.remove("show")},5E3)}
function showToast(a,b){b=void 0===b?"success":b;var c=document.getElementById("toast");c.textContent=a;c.className="toast "+b+" show";setTimeout(function(){c.classList.remove("show")},3E3)}function showSection(a){document.querySelectorAll(".content-section").forEach(function(b){return b.classList.remove("active")});document.getElementById(a+"Section").classList.add("active");"history"===a?loadHistory():"favorites"===a&&loadFavorites()}
function generateDiagram(){var a,b,c,d,e,f,g;return $jscomp.asyncExecutePromiseGeneratorProgram(function(l){switch(l.nextAddress){case 1:a=document.getElementById("descriptionInput").value.trim();b=document.getElementById("diagramTitle").value.trim();c=document.getElementById("saveHistory").checked;if(!a)return showToast("\u8bf7\u8f93\u5165\u56fe\u8868\u63cf\u8ff0","error"),l.return();d=document.getElementById("previewLoading");d.style.display="flex";l.setCatchFinallyBlocks(2,3);return l.yield(fetch(API_BASE_URL+
"/ai/convert",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+currentToken},body:JSON.stringify({description:a,title:b||"\u672a\u547d\u540d\u56fe\u8868",saveHistory:c})}),5);case 5:return e=l.yieldResult,l.yield(e.json(),6);case 6:f=l.yieldResult,f.success?(document.getElementById("plantumlCode").value=f.plantumlCode,f.historyId&&(currentHistoryId=f.historyId,currentIsFavorite=!1,updateFavoriteButton()),showToast("\u751f\u6210\u6210\u529f\uff01","success"),refreshPreview()):
showToast(f.message||"\u751f\u6210\u5931\u8d25","error");case 3:l.enterFinallyBlock();d.style.display="none";l.leaveFinallyBlock(0);break;case 2:g=l.enterCatchBlock(),showToast("\u7f51\u7edc\u9519\u8bef\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5","error"),console.error("Generate error:",g),l.jumpTo(3)}})}
function optimizeDiagram(){var a,b,c,d,e,f,g,l,k;return $jscomp.asyncExecutePromiseGeneratorProgram(function(h){switch(h.nextAddress){case 1:a=document.getElementById("plantumlCode");b=a.value.trim();c=document.getElementById("optimizeInstruction");d=c.value.trim();if(!b)return showToast("\u8bf7\u5148\u751f\u6210PlantUML\u4ee3\u7801","error"),h.return();if(!d)return showToast("\u8bf7\u8f93\u5165\u4f18\u5316\u6307\u4ee4","error"),h.return();e=document.getElementById("previewLoading");e.style.display=
"flex";h.setCatchFinallyBlocks(2,3);console.log("\u53d1\u9001\u4f18\u5316\u8bf7\u6c42...");return h.yield(fetch(API_BASE_URL+"/ai/optimize",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+currentToken},body:JSON.stringify({plantumlCode:b,instruction:d})}),5);case 5:return f=h.yieldResult,h.yield(f.json(),6);case 6:g=h.yieldResult;console.log("\u4f18\u5316\u54cd\u5e94:",g);if(!g.success||!g.plantumlCode){console.error("\u4f18\u5316\u5931\u8d25:",g);showToast(g.message||
"\u4f18\u5316\u5931\u8d25","error");h.jumpTo(3);break}a.value=g.plantumlCode;a.dispatchEvent(new Event("input",{bubbles:!0}));console.log("\u4ee3\u7801\u5df2\u66f4\u65b0:",g.plantumlCode.substring(0,100)+"...");l=document.getElementById("saveHistory").checked;if(currentHistoryId||!l){h.jumpTo(8);break}return h.yield(saveOptimizedToHistory(g.plantumlCode,"\u4f18\u5316\uff1a"+d),8);case 8:c.value="",showToast("\u4f18\u5316\u6210\u529f\uff01\u4ee3\u7801\u5df2\u66f4\u65b0","success"),setTimeout(function(){refreshPreview()},
100);case 3:h.enterFinallyBlock();e.style.display="none";h.leaveFinallyBlock(0);break;case 2:k=h.enterCatchBlock(),console.error("Optimize error:",k),showToast("\u7f51\u7edc\u9519\u8bef\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5","error"),h.jumpTo(3)}})}
function updateHistoryRecord(a,b,c){var d,e,f;return $jscomp.asyncExecutePromiseGeneratorProgram(function(g){switch(g.nextAddress){case 1:return g.setCatchFinallyBlocks(2),g.yield(fetch(API_BASE_URL+"/history/"+a,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer "+currentToken},body:JSON.stringify({plantumlCode:b,title:document.getElementById("diagramTitle").value.trim()||"\u672a\u547d\u540d\u56fe\u8868",changeDescription:c||"AI\u4f18\u5316\u66f4\u65b0"})}),4);case 4:return d=
g.yieldResult,g.yield(d.json(),5);case 5:e=g.yieldResult;e.success&&console.log("\u5386\u53f2\u8bb0\u5f55\u5df2\u66f4\u65b0\uff0c\u7248\u672c\u5df2\u4fdd\u5b58:",c);g.leaveTryBlock(0);break;case 2:f=g.enterCatchBlock(),console.error("Update history error:",f),g.jumpToEnd()}})}
function showSaveVersionDialog(){if(currentHistoryId)if(document.getElementById("plantumlCode").value.trim()){var a=document.createElement("div");a.className="save-version-modal";a.innerHTML='\n        \x3cdiv class\x3d"save-version-modal-content"\x3e\n            \x3cdiv class\x3d"save-version-modal-header"\x3e\n                \x3ch3\x3e\x3ci class\x3d"fas fa-save"\x3e\x3c/i\x3e \u4fdd\u5b58\u7248\u672c\x3c/h3\x3e\n                \x3cbutton class\x3d"save-version-modal-close" onclick\x3d"this.closest(\'.save-version-modal\').remove()"\x3e\n                    \x3ci class\x3d"fas fa-times"\x3e\x3c/i\x3e\n                \x3c/button\x3e\n            \x3c/div\x3e\n            \x3cdiv class\x3d"save-version-modal-body"\x3e\n                \x3cdiv class\x3d"form-group"\x3e\n                    \x3clabel\x3e\u7248\u672c\u63cf\u8ff0\x3c/label\x3e\n                    \x3ctextarea id\x3d"versionDescriptionInput" placeholder\x3d"\u8bf7\u8f93\u5165\u6b64\u7248\u672c\u7684\u53d8\u66f4\u63cf\u8ff0...\x26#10;\x26#10;\u4f8b\u5982\uff1a\x26#10;- \u6dfb\u52a0\u4e86\u7528\u6237\u8ba4\u8bc1\u6d41\u7a0b\x26#10;- \u4f18\u5316\u4e86\u7c7b\u5173\u7cfb\u7ed3\u6784\x26#10;- \u4fee\u590d\u4e86\u5e03\u5c40\u95ee\u9898" rows\x3d"4"\x3e\x3c/textarea\x3e\n                \x3c/div\x3e\n                \x3cdiv class\x3d"version-info"\x3e\n                    \x3ci class\x3d"fas fa-info-circle"\x3e\x3c/i\x3e\n                    \x3cspan\x3e\u7cfb\u7edf\u5c06\u4fdd\u6301\u6700\u8fd120\u4e2a\u7248\u672c\uff0c\u65e7\u7248\u672c\u5c06\u81ea\u52a8\u6e05\u7406\x3c/span\x3e\n                \x3c/div\x3e\n            \x3c/div\x3e\n            \x3cdiv class\x3d"save-version-modal-footer"\x3e\n                \x3cbutton class\x3d"btn-cancel" onclick\x3d"this.closest(\'.save-version-modal\').remove()"\x3e\n                    \x3ci class\x3d"fas fa-times"\x3e\x3c/i\x3e \u53d6\u6d88\n                \x3c/button\x3e\n                \x3cbutton class\x3d"btn-save" onclick\x3d"saveVersion()"\x3e\n                    \x3ci class\x3d"fas fa-check"\x3e\x3c/i\x3e \u4fdd\u5b58\u7248\u672c\n                \x3c/button\x3e\n            \x3c/div\x3e\n        \x3c/div\x3e\n    ';document.body.appendChild(a);
a.addEventListener("click",function(b){b.target===a&&a.remove()});setTimeout(function(){document.getElementById("versionDescriptionInput").focus()},100)}else showToast("\u6ca1\u6709\u53ef\u4fdd\u5b58\u7684\u4ee3\u7801","error");else showToast("\u8bf7\u5148\u751f\u6210\u56fe\u8868\u5e76\u4fdd\u5b58\u5230\u5386\u53f2\u8bb0\u5f55","error")}
function saveVersion(){var a,b,c,d,e,f;return $jscomp.asyncExecutePromiseGeneratorProgram(function(g){switch(g.nextAddress){case 1:a=document.getElementById("versionDescriptionInput").value.trim();if(!a)return showToast("\u8bf7\u8f93\u5165\u7248\u672c\u63cf\u8ff0","error"),g.return();b=document.getElementById("plantumlCode").value.trim();g.setCatchFinallyBlocks(2);return g.yield(fetch(API_BASE_URL+"/history/"+currentHistoryId,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer "+
currentToken},body:JSON.stringify({plantumlCode:b,title:document.getElementById("diagramTitle").value.trim()||"\u672a\u547d\u540d\u56fe\u8868",changeDescription:a})}),4);case 4:return c=g.yieldResult,g.yield(c.json(),5);case 5:d=g.yieldResult;d.success?(showToast("\u7248\u672c\u5df2\u4fdd\u5b58","success"),null==(e=document.querySelector(".save-version-modal"))||e.remove()):showToast(d.message||"\u4fdd\u5b58\u5931\u8d25","error");g.leaveTryBlock(0);break;case 2:f=g.enterCatchBlock(),showToast("\u7f51\u7edc\u9519\u8bef\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5",
"error"),console.error("Save version error:",f),g.jumpToEnd()}})}
function viewVersionHistory(a){var b,c,d;return $jscomp.asyncExecutePromiseGeneratorProgram(function(e){switch(e.nextAddress){case 1:return e.setCatchFinallyBlocks(2),e.yield(fetch(API_BASE_URL+"/history/"+a+"/versions",{headers:{Authorization:"Bearer "+currentToken}}),4);case 4:return b=e.yieldResult,e.yield(b.json(),5);case 5:c=e.yieldResult;c.success?showVersionModal(c.data,a):showToast(c.message||"\u83b7\u53d6\u7248\u672c\u5931\u8d25","error");e.leaveTryBlock(0);break;case 2:d=e.enterCatchBlock(),
showToast("\u7f51\u7edc\u9519\u8bef\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5","error"),console.error("View version history error:",d),e.jumpToEnd()}})}
function showVersionModal(a,b){if(0===a.length)showToast("\u6682\u65e0\u5386\u53f2\u7248\u672c","info");else{var c=document.createElement("div");c.className="version-modal";c.innerHTML='\n        \x3cdiv class\x3d"version-modal-content"\x3e\n            \x3cdiv class\x3d"version-modal-header"\x3e\n                \x3ch3\x3e\x3ci class\x3d"fas fa-history"\x3e\x3c/i\x3e \u7248\u672c\u5386\u53f2\uff08\u6700\u8fd120\u4e2a\u7248\u672c\uff09\x3c/h3\x3e\n                \x3cbutton class\x3d"version-modal-close" onclick\x3d"this.closest(\'.version-modal\').remove()"\x3e\n                    \x3ci class\x3d"fas fa-times"\x3e\x3c/i\x3e\n                \x3c/button\x3e\n            \x3c/div\x3e\n            \x3cdiv class\x3d"version-modal-body"\x3e\n                        \x3cdiv class\x3d"version-list"\x3e\n                            '+a.map(function(d){var e=
escapeHtml(d.title||"\u7248\u672c "+d.versionNumber);return'\n                                \x3cdiv class\x3d"version-item" onclick\x3d"restoreVersion('+d.id+", "+b+", '"+e.replace(/'/g,"\\'")+'\')"\x3e\n                                    \x3cdiv class\x3d"version-item-header"\x3e\n                                        \x3cspan class\x3d"version-number"\x3e'+e+'\x3c/span\x3e\n                                        \x3cspan class\x3d"version-date"\x3e'+formatDate(d.createdAt)+"\x3c/span\x3e\n                                    \x3c/div\x3e\n                                    "+
(d.changeDescription?'\x3cdiv class\x3d"version-item-desc"\x3e'+escapeHtml(d.changeDescription)+"\x3c/div\x3e":"")+"\n                                \x3c/div\x3e\n                                "}).join("")+'\n                        \x3c/div\x3e\n            \x3c/div\x3e\n            \x3cdiv class\x3d"version-modal-footer"\x3e\n                \x3cbutton class\x3d"btn-secondary" onclick\x3d"this.closest(\'.version-modal\').remove()"\x3e\u5173\u95ed\x3c/button\x3e\n            \x3c/div\x3e\n        \x3c/div\x3e\n    ';
document.body.appendChild(c);c.addEventListener("click",function(d){d.target===c&&c.remove()})}}
function showRestoreConfirmDialog(a,b,c){var d=document.createElement("div");d.className="restore-confirm-modal";d.innerHTML='\n        \x3cdiv class\x3d"restore-confirm-modal-content"\x3e\n            \x3cdiv class\x3d"restore-confirm-modal-header"\x3e\n                \x3cdiv class\x3d"restore-icon-wrapper"\x3e\n                    \x3ci class\x3d"fas fa-history"\x3e\x3c/i\x3e\n                \x3c/div\x3e\n            \x3c/div\x3e\n            \x3cdiv class\x3d"restore-confirm-modal-body"\x3e\n                \x3ch3\x3e\u786e\u8ba4\u6062\u590d\u7248\u672c\x3c/h3\x3e\n                \x3cp\x3e\u60a8\u786e\u5b9a\u8981\u6062\u590d\u5230\u6b64\u7248\u672c\u5417\uff1f\x3c/p\x3e\n                \x3cdiv class\x3d"restore-item-info"\x3e\n                    \x3ci class\x3d"fas fa-code-branch"\x3e\x3c/i\x3e\n                    \x3cspan\x3e'+c+
'\x3c/span\x3e\n                \x3c/div\x3e\n                \x3cdiv class\x3d"restore-warning"\x3e\n                    \x3ci class\x3d"fas fa-info-circle"\x3e\x3c/i\x3e\n                    \x3cspan\x3e\u5f53\u524d\u672a\u4fdd\u5b58\u7684\u4fee\u6539\u5c06\u4f1a\u4e22\u5931\uff0c\u6062\u590d\u540e\u4ee3\u7801\u7f16\u8f91\u5668\u5c06\u88ab\u66ff\u6362\u4e3a\u9009\u5b9a\u7248\u672c\u7684\u5185\u5bb9\x3c/span\x3e\n                \x3c/div\x3e\n            \x3c/div\x3e\n            \x3cdiv class\x3d"restore-confirm-modal-footer"\x3e\n                \x3cbutton class\x3d"btn-cancel" onclick\x3d"this.closest(\'.restore-confirm-modal\').remove()"\x3e\n                    \x3ci class\x3d"fas fa-times"\x3e\x3c/i\x3e \u53d6\u6d88\n                \x3c/button\x3e\n                \x3cbutton class\x3d"btn-restore" onclick\x3d"confirmRestoreVersion('+
a+", "+b+", '"+c.replace(/'/g,"\\'")+'\')"\x3e\n                    \x3ci class\x3d"fas fa-undo"\x3e\x3c/i\x3e \u6062\u590d\u7248\u672c\n                \x3c/button\x3e\n            \x3c/div\x3e\n        \x3c/div\x3e\n    ';document.body.appendChild(d);d.addEventListener("click",function(f){f.target===d&&d.remove()});var e=function(f){"Escape"===f.key&&(d.remove(),document.removeEventListener("keydown",e))};document.addEventListener("keydown",e)}
function restoreVersion(a,b,c){return $jscomp.asyncExecutePromiseGeneratorProgram(function(d){showRestoreConfirmDialog(a,b,c);d.jumpToEnd()})}
function confirmRestoreVersion(a,b,c){var d,e,f,g,l,k;return $jscomp.asyncExecutePromiseGeneratorProgram(function(h){switch(h.nextAddress){case 1:return null==(d=document.querySelector(".restore-confirm-modal"))||d.remove(),h.setCatchFinallyBlocks(2),h.yield(fetch(API_BASE_URL+"/history/"+b+"/versions/"+a,{headers:{Authorization:"Bearer "+currentToken}}),4);case 4:return e=h.yieldResult,h.yield(e.json(),5);case 5:f=h.yieldResult;f.success?(g=f.data,document.getElementById("plantumlCode").value=g.plantumlCode,
null==(l=document.querySelector(".version-modal"))||l.remove(),refreshPreview(),showToast("\u5df2\u6062\u590d\u5230\uff1a"+c,"success")):showToast(f.message||"\u6062\u590d\u5931\u8d25","error");h.leaveTryBlock(0);break;case 2:k=h.enterCatchBlock(),showToast("\u7f51\u7edc\u9519\u8bef\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5","error"),console.error("Restore version error:",k),h.jumpToEnd()}})}
function saveOptimizedToHistory(a,b){var c,d,e;return $jscomp.asyncExecutePromiseGeneratorProgram(function(f){switch(f.nextAddress){case 1:return f.setCatchFinallyBlocks(2),f.yield(fetch(API_BASE_URL+"/history",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+currentToken},body:JSON.stringify({originalText:document.getElementById("descriptionInput").value.trim(),plantumlCode:a,title:document.getElementById("diagramTitle").value.trim()||"\u672a\u547d\u540d\u56fe\u8868",
description:b||"\u9996\u6b21\u4fdd\u5b58"})}),4);case 4:return c=f.yieldResult,f.yield(c.json(),5);case 5:d=f.yieldResult;d.success&&d.id&&(currentHistoryId=d.id,currentIsFavorite=!1,updateFavoriteButton(),console.log("\u5df2\u4fdd\u5b58\u5230\u5386\u53f2\u8bb0\u5f55:",b));f.leaveTryBlock(0);break;case 2:e=f.enterCatchBlock(),console.error("Save optimized history error:",e),f.jumpToEnd()}})}
function refreshPreview(){var a,b,c,d,e,f;return $jscomp.asyncExecutePromiseGeneratorProgram(function(g){switch(g.nextAddress){case 1:a=document.getElementById("plantumlCode").value.trim();if(!a)return showToast("\u8bf7\u5148\u751f\u6210PlantUML\u4ee3\u7801","warning"),g.return();b=document.getElementById("previewContainer");b.innerHTML='\x3cdiv class\x3d"loading-spinner"\x3e\x3ci class\x3d"fas fa-spinner fa-spin"\x3e\x3c/i\x3e\x3cp\x3e\u751f\u6210\u9884\u89c8\u4e2d...\x3c/p\x3e\x3c/div\x3e';g.setCatchFinallyBlocks(2);
return g.yield(fetch(window.location.origin+"/plantuml/coder",{method:"POST",headers:{"Content-Type":"text/plain"},body:a}),4);case 4:c=g.yieldResult;if(!c.ok){handlePreviewError();g.jumpTo(5);break}return g.yield(c.text(),6);case 6:d=g.yieldResult,e=window.location.origin+"/plantuml/svg/"+d,b.innerHTML='\x3cimg src\x3d"'+e+'" alt\x3d"PlantUML Diagram" onerror\x3d"handlePreviewError()"\x3e',setTimeout(function(){var l=document.getElementById("fullscreenBtn");l&&b.querySelector("img")&&(l.style.display=
"inline-flex")},100);case 5:g.leaveTryBlock(0);break;case 2:f=g.enterCatchBlock(),console.error("Preview error:",f),handlePreviewError(),g.jumpToEnd()}})}function handlePreviewError(){document.getElementById("previewContainer").innerHTML='\x3cp class\x3d"preview-placeholder" style\x3d"color: var(--error-color);"\x3e\u9884\u89c8\u751f\u6210\u5931\u8d25\uff0c\u8bf7\u68c0\u67e5PlantUML\u4ee3\u7801\x3c/p\x3e'}
function clearInput(){document.getElementById("descriptionInput").value="";document.getElementById("diagramTitle").value="";document.getElementById("plantumlCode").value="";document.getElementById("previewContainer").innerHTML='\x3cp class\x3d"preview-placeholder"\x3e\u56fe\u8868\u9884\u89c8\u5c06\u5728\u8fd9\u91cc\u663e\u793a\x3c/p\x3e';currentHistoryId=null;currentIsFavorite=!1;document.getElementById("favoriteBtn").style.display="none";document.getElementById("versionBtn").style.display="none";
document.getElementById("saveVersionBtn").style.display="none"}function copyCode(){var a=document.getElementById("plantumlCode").value;a?navigator.clipboard.writeText(a).then(function(){showToast("\u4ee3\u7801\u5df2\u590d\u5236\u5230\u526a\u8d34\u677f","success")}).catch(function(){showToast("\u590d\u5236\u5931\u8d25","error")}):showToast("\u6ca1\u6709\u53ef\u590d\u5236\u7684\u4ee3\u7801","warning")}
function downloadCode(){var a=document.getElementById("plantumlCode").value,b=document.getElementById("diagramTitle").value||"diagram";if(a){a=new Blob([a],{type:"text/plain"});a=URL.createObjectURL(a);var c=document.createElement("a");c.href=a;c.download=b+".puml";c.click();URL.revokeObjectURL(a);showToast("\u4ee3\u7801\u5df2\u4e0b\u8f7d","success")}else showToast("\u6ca1\u6709\u53ef\u4e0b\u8f7d\u7684\u4ee3\u7801","warning")}
function downloadImage(a){var b,c,d,e,f,g,l;return $jscomp.asyncExecutePromiseGeneratorProgram(function(k){switch(k.nextAddress){case 1:b=document.getElementById("plantumlCode").value.trim();c=document.getElementById("diagramTitle").value||"diagram";if(!b)return showToast("\u8bf7\u5148\u751f\u6210\u56fe\u8868","warning"),k.return();k.setCatchFinallyBlocks(2);return k.yield(fetch(window.location.origin+"/plantuml/coder",{method:"POST",headers:{"Content-Type":"text/plain"},body:b}),4);case 4:d=k.yieldResult;
if(!d.ok){showToast("\u7f16\u7801\u5931\u8d25\uff0c\u8bf7\u68c0\u67e5PlantUML\u4ee3\u7801","error");k.jumpTo(5);break}return k.yield(d.text(),6);case 6:e=k.yieldResult,f=window.location.origin+"/plantuml/"+a+"/"+e,g=document.createElement("a"),g.href=f,g.download=c+"."+a,g.click(),showToast("\u56fe\u7247\u5df2\u4e0b\u8f7d ("+a.toUpperCase()+")","success");case 5:k.leaveTryBlock(0);break;case 2:l=k.enterCatchBlock(),console.error("Download error:",l),showToast("\u4e0b\u8f7d\u5931\u8d25\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5",
"error"),k.jumpToEnd()}})}
function loadHistory(a){a=void 0===a?1:a;var b,c,d;return $jscomp.asyncExecutePromiseGeneratorProgram(function(e){switch(e.nextAddress){case 1:return currentPage=a,e.setCatchFinallyBlocks(2),console.log("Loading history, page:",a),e.yield(fetch(API_BASE_URL+"/history?page\x3d"+a+"\x26pageSize\x3d"+pageSize,{headers:{Authorization:"Bearer "+currentToken}}),4);case 4:b=e.yieldResult;console.log("Response status:",b.status);if(!b.ok)throw Error("HTTP error! status: "+b.status);return e.yield(b.json(),
5);case 5:c=e.yieldResult;console.log("History data:",c);if(!c.success){console.error("API returned success\x3dfalse:",c.message);showToast(c.message||"\u52a0\u8f7d\u5931\u8d25","error");e.jumpTo(6);break}console.log("Displaying history list with",c.data.length,"items");return e.yield(displayHistoryList(c.data),7);case 7:displayPagination(c.total,c.page,c.pageSize);case 6:e.leaveTryBlock(0);break;case 2:d=e.enterCatchBlock(),console.error("Load history error:",d),console.error("Error stack:",d.stack),
showToast("\u7f51\u7edc\u9519\u8bef\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5: "+d.message,"error"),e.jumpToEnd()}})}
function displayHistoryList(a){var b,c,d,e;return $jscomp.asyncExecutePromiseGeneratorProgram(function(f){b=document.getElementById("historyList");if(!a||0===a.length)return b.innerHTML='\x3cp style\x3d"text-align: center; color: var(--text-muted); grid-column: 1/-1;"\x3e\u6682\u65e0\u5386\u53f2\u8bb0\u5f55\x3c/p\x3e',f.return();try{for(b.innerHTML=a.map(function(g){var l=g.isFavorite||!1,k=escapeHtml(g.title||"\u672a\u547d\u540d\u56fe\u8868"),h=escapeHtml(g.originalText||""),m=formatDate(g.createdAt);
return'\n                \x3cdiv class\x3d"history-card" onclick\x3d"loadHistoryItem('+g.id+')"\x3e\n                    \x3cdiv class\x3d"history-card-header"\x3e\n                        \x3cdiv\x3e\n                            \x3cdiv class\x3d"history-card-title"\x3e'+k+'\x3c/div\x3e\n                            \x3cdiv class\x3d"history-card-date"\x3e'+m+'\x3c/div\x3e\n                        \x3c/div\x3e\n                        \x3cdiv class\x3d"history-card-actions"\x3e\n                            \x3cbutton onclick\x3d"event.stopPropagation(); toggleFavorite('+
g.id+", "+!l+')" title\x3d"'+(l?"\u53d6\u6d88\u6536\u85cf":"\u6536\u85cf")+'"\x3e\n                                \x3ci class\x3d"'+(l?"fas":"far")+' fa-star"\x3e\x3c/i\x3e\n                            \x3c/button\x3e\n                            \x3cbutton onclick\x3d"event.stopPropagation(); deleteHistory('+g.id+", '"+k.replace(/'/g,"\\'")+'\' )" title\x3d"\u5220\u9664"\x3e\n                                \x3ci class\x3d"fas fa-trash"\x3e\x3c/i\x3e\n                            \x3c/button\x3e\n                        \x3c/div\x3e\n                    \x3c/div\x3e\n                    \x3cdiv class\x3d"history-card-description"\x3e'+
h+'\x3c/div\x3e\n                    \x3cdiv class\x3d"history-card-preview"\x3e\n                        \x3cdiv class\x3d"loading-spinner" data-id\x3d"'+g.id+'"\x3e\u52a0\u8f7d\u4e2d...\x3c/div\x3e\n                    \x3c/div\x3e\n                \x3c/div\x3e\n            '}).join(""),c={},d=$jscomp.makeIterator(a),e=d.next();!e.done;c={$jscomp$loop$prop$history$4$12:c.$jscomp$loop$prop$history$4$12},e=d.next())c.$jscomp$loop$prop$history$4$12=e.value,encodePlantUML(c.$jscomp$loop$prop$history$4$12.plantumlCode).then(function(g){return function(l){var k=
document.querySelector('.loading-spinner[data-id\x3d"'+g.$jscomp$loop$prop$history$4$12.id+'"]');k&&k.parentElement&&(k.parentElement.innerHTML='\x3cimg src\x3d"'+window.location.origin+"/plantuml/svg/"+l+'" alt\x3d"Preview" onerror\x3d"this.src\x3d\'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48dGV4dCB4PSI1MCIgeT0iNTAiIHRleHQtYW5jaG9yPSJtaWRkbGUiPumihOiniOWksei0pTwvdGV4dD48L3N2Zz4\x3d\'"\x3e')}}(c)).catch(function(g){return function(l){console.error("Failed to encode PlantUML for history",
g.$jscomp$loop$prop$history$4$12.id,l);(l=document.querySelector('.loading-spinner[data-id\x3d"'+g.$jscomp$loop$prop$history$4$12.id+'"]'))&&l.parentElement&&(l.parentElement.innerHTML='\x3cdiv style\x3d"text-align:center;color:#999;"\x3e\u9884\u89c8\u5931\u8d25\x3c/div\x3e')}}(c))}catch(g){console.error("Error displaying history list:",g),b.innerHTML='\x3cp style\x3d"text-align: center; color: var(--text-muted); grid-column: 1/-1;"\x3e\u663e\u793a\u5386\u53f2\u8bb0\u5f55\u65f6\u51fa\u9519\x3c/p\x3e'}f.jumpToEnd()})}
function displayPagination(a,b,c){a=Math.ceil(a/c);c=document.getElementById("historyPagination");if(1>=a)c.innerHTML="";else{var d='\x3cbutton onclick\x3d"loadHistory('+(b-1)+')" '+(1>=b?"disabled":"")+"\x3e\u4e0a\u4e00\u9875\x3c/button\x3e";for(var e=1;e<=a;e++)if(1===e||e===a||e>=b-2&&e<=b+2)d+='\x3cbutton onclick\x3d"loadHistory('+e+')" class\x3d"'+(e===b?"active":"")+'"\x3e'+e+"\x3c/button\x3e";else if(e===b-3||e===b+3)d+="\x3cspan\x3e...\x3c/span\x3e";c.innerHTML=d+('\x3cbutton onclick\x3d"loadHistory('+
(b+1)+')" '+(b>=a?"disabled":"")+"\x3e\u4e0b\u4e00\u9875\x3c/button\x3e")}}
function loadHistoryItem(a){var b,c,d,e;return $jscomp.asyncExecutePromiseGeneratorProgram(function(f){switch(f.nextAddress){case 1:return f.setCatchFinallyBlocks(2),f.yield(fetch(API_BASE_URL+"/history/"+a,{headers:{Authorization:"Bearer "+currentToken}}),4);case 4:return b=f.yieldResult,f.yield(b.json(),5);case 5:c=f.yieldResult;c.success?(d=c.data,document.getElementById("descriptionInput").value=d.originalText,document.getElementById("plantumlCode").value=d.plantumlCode,document.getElementById("diagramTitle").value=
d.title,currentHistoryId=d.id,currentIsFavorite=d.isFavorite||!1,updateFavoriteButton(),showSection("editor"),refreshPreview(),showToast("\u5df2\u52a0\u8f7d\u5386\u53f2\u8bb0\u5f55","success")):showToast(c.message||"\u52a0\u8f7d\u5931\u8d25","error");f.leaveTryBlock(0);break;case 2:e=f.enterCatchBlock(),showToast("\u7f51\u7edc\u9519\u8bef\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5","error"),console.error("Load history item error:",e),f.jumpToEnd()}})}
function toggleFavorite(a,b){var c,d,e,f;return $jscomp.asyncExecutePromiseGeneratorProgram(function(g){switch(g.nextAddress){case 1:return g.setCatchFinallyBlocks(2),g.yield(fetch(API_BASE_URL+"/history/"+a+"/favorite",{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer "+currentToken},body:JSON.stringify({isFavorite:b})}),4);case 4:return c=g.yieldResult,g.yield(c.json(),5);case 5:d=g.yieldResult;d.success?(showToast(d.message,"success"),(e=document.querySelector(".content-section.active"))&&
"favoritesSection"===e.id?loadFavorites():loadHistory(currentPage),currentHistoryId===a&&(currentIsFavorite=b,updateFavoriteButton())):showToast(d.message||"\u64cd\u4f5c\u5931\u8d25","error");g.leaveTryBlock(0);break;case 2:f=g.enterCatchBlock(),showToast("\u7f51\u7edc\u9519\u8bef\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5","error"),console.error("Toggle favorite error:",f),g.jumpToEnd()}})}
function toggleCurrentFavorite(){var a,b,c,d,e,f,g,l,k,h;return $jscomp.asyncExecutePromiseGeneratorProgram(function(m){switch(m.nextAddress){case 1:if(!currentHistoryId){e=document.getElementById("plantumlCode").value.trim();f=document.getElementById("descriptionInput").value.trim();g=document.getElementById("diagramTitle").value.trim()||"\u672a\u547d\u540d\u56fe\u8868";if(!e||!f)return showToast("\u8bf7\u5148\u751f\u6210\u56fe\u8868","error"),m.return();m.setCatchFinallyBlocks(8);return m.yield(fetch(API_BASE_URL+
"/history",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+currentToken},body:JSON.stringify({originalText:f,plantumlCode:e,title:g,isFavorite:!0})}),10)}a=!currentIsFavorite;m.setCatchFinallyBlocks(4);return m.yield(fetch(API_BASE_URL+"/history/"+currentHistoryId+"/favorite",{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer "+currentToken},body:JSON.stringify({isFavorite:a})}),6);case 6:return b=m.yieldResult,m.yield(b.json(),7);case 7:c=
m.yieldResult;c.success?(currentIsFavorite=a,updateFavoriteButton(),showToast(a?"\u5df2\u6536\u85cf":"\u5df2\u53d6\u6d88\u6536\u85cf","success")):showToast(c.message||"\u64cd\u4f5c\u5931\u8d25","error");m.leaveTryBlock(0);break;case 4:d=m.enterCatchBlock();showToast("\u7f51\u7edc\u9519\u8bef\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5","error");console.error("Toggle current favorite error:",d);m.jumpTo(0);break;case 10:return l=m.yieldResult,m.yield(l.json(),11);case 11:k=m.yieldResult;k.success?(currentHistoryId=
k.id,currentIsFavorite=!0,updateFavoriteButton(),showToast("\u5df2\u6536\u85cf","success")):showToast(k.message||"\u6536\u85cf\u5931\u8d25","error");m.leaveTryBlock(0);break;case 8:h=m.enterCatchBlock(),showToast("\u7f51\u7edc\u9519\u8bef\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5","error"),console.error("Save and favorite error:",h),m.jumpToEnd()}})}
function updateFavoriteButton(){var a=document.getElementById("favoriteBtn"),b=document.getElementById("versionBtn"),c=document.getElementById("saveVersionBtn"),d=a.querySelector("i");a.style.display="";currentHistoryId&&(b.style.display="",c.style.display="");currentIsFavorite?(d.className="fas fa-star",a.title="\u53d6\u6d88\u6536\u85cf"):(d.className="far fa-star",a.title="\u6536\u85cf\u5f53\u524d\u56fe\u8868")}
function showDeleteConfirmDialog(a,b){var c=document.createElement("div");c.className="delete-confirm-modal";c.innerHTML='\n        \x3cdiv class\x3d"delete-confirm-modal-content"\x3e\n            \x3cdiv class\x3d"delete-confirm-modal-header"\x3e\n                \x3cdiv class\x3d"delete-icon-wrapper"\x3e\n                    \x3ci class\x3d"fas fa-exclamation-triangle"\x3e\x3c/i\x3e\n                \x3c/div\x3e\n            \x3c/div\x3e\n            \x3cdiv class\x3d"delete-confirm-modal-body"\x3e\n                \x3ch3\x3e\u786e\u8ba4\u5220\u9664\x3c/h3\x3e\n                \x3cp\x3e\u60a8\u786e\u5b9a\u8981\u5220\u9664\u8fd9\u6761\u8bb0\u5f55\u5417\uff1f\x3c/p\x3e\n                '+
(b?'\x3cdiv class\x3d"delete-item-info"\x3e\n                    \x3ci class\x3d"fas fa-file-alt"\x3e\x3c/i\x3e\n                    \x3cspan\x3e'+escapeHtml(b)+"\x3c/span\x3e\n                \x3c/div\x3e":"")+'\n                \x3cdiv class\x3d"delete-warning"\x3e\n                    \x3ci class\x3d"fas fa-info-circle"\x3e\x3c/i\x3e\n                    \x3cspan\x3e\u6b64\u64cd\u4f5c\u4e0d\u53ef\u6062\u590d\uff0c\u8bb0\u5f55\u53ca\u5176\u6240\u6709\u7248\u672c\u90fd\u5c06\u88ab\u6c38\u4e45\u5220\u9664\x3c/span\x3e\n                \x3c/div\x3e\n            \x3c/div\x3e\n            \x3cdiv class\x3d"delete-confirm-modal-footer"\x3e\n                \x3cbutton class\x3d"btn-cancel" onclick\x3d"this.closest(\'.delete-confirm-modal\').remove()"\x3e\n                    \x3ci class\x3d"fas fa-times"\x3e\x3c/i\x3e \u53d6\u6d88\n                \x3c/button\x3e\n                \x3cbutton class\x3d"btn-delete" onclick\x3d"confirmDeleteHistory('+
a+')"\x3e\n                    \x3ci class\x3d"fas fa-trash-alt"\x3e\x3c/i\x3e \u786e\u8ba4\u5220\u9664\n                \x3c/button\x3e\n            \x3c/div\x3e\n        \x3c/div\x3e\n    ';document.body.appendChild(c);c.addEventListener("click",function(e){e.target===c&&c.remove()});var d=function(e){"Escape"===e.key&&(c.remove(),document.removeEventListener("keydown",d))};document.addEventListener("keydown",d)}
function deleteHistory(a,b){return $jscomp.asyncExecutePromiseGeneratorProgram(function(c){showDeleteConfirmDialog(a,b);c.jumpToEnd()})}
function confirmDeleteHistory(a){var b,c,d,e;return $jscomp.asyncExecutePromiseGeneratorProgram(function(f){switch(f.nextAddress){case 1:return null==(b=document.querySelector(".delete-confirm-modal"))||b.remove(),f.setCatchFinallyBlocks(2),f.yield(fetch(API_BASE_URL+"/history/"+a,{method:"DELETE",headers:{Authorization:"Bearer "+currentToken}}),4);case 4:return c=f.yieldResult,f.yield(c.json(),5);case 5:d=f.yieldResult;d.success?(showToast("\u5220\u9664\u6210\u529f","success"),loadHistory(currentPage)):
showToast(d.message||"\u5220\u9664\u5931\u8d25","error");f.leaveTryBlock(0);break;case 2:e=f.enterCatchBlock(),showToast("\u7f51\u7edc\u9519\u8bef\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5","error"),console.error("Delete history error:",e),f.jumpToEnd()}})}
function loadFavorites(){var a,b,c,d,e,f,g;return $jscomp.asyncExecutePromiseGeneratorProgram(function(l){switch(l.nextAddress){case 1:return l.setCatchFinallyBlocks(2),l.yield(fetch(API_BASE_URL+"/history/favorites",{headers:{Authorization:"Bearer "+currentToken}}),4);case 4:return a=l.yieldResult,l.yield(a.json(),5);case 5:b=l.yieldResult;if(b.success){c=document.getElementById("favoritesList");if(0===b.data.length)return c.innerHTML='\x3cp style\x3d"text-align: center; color: var(--text-muted); grid-column: 1/-1;"\x3e\u6682\u65e0\u6536\u85cf\x3c/p\x3e',
l.return();c.innerHTML=b.data.map(function(k){var h=escapeHtml(k.title||"\u672a\u547d\u540d\u56fe\u8868"),m=escapeHtml(k.originalText||""),q=formatDate(k.createdAt);return'\n                    \x3cdiv class\x3d"history-card" onclick\x3d"loadHistoryItem('+k.id+')"\x3e\n                        \x3cdiv class\x3d"history-card-header"\x3e\n                            \x3cdiv\x3e\n                                \x3cdiv class\x3d"history-card-title"\x3e'+h+'\x3c/div\x3e\n                                \x3cdiv class\x3d"history-card-date"\x3e'+
q+'\x3c/div\x3e\n                            \x3c/div\x3e\n                            \x3cdiv class\x3d"history-card-actions"\x3e\n                                \x3cbutton onclick\x3d"event.stopPropagation(); toggleFavorite('+k.id+', false)" title\x3d"\u53d6\u6d88\u6536\u85cf"\x3e\n                                    \x3ci class\x3d"fas fa-star"\x3e\x3c/i\x3e\n                                \x3c/button\x3e\n                            \x3c/div\x3e\n                        \x3c/div\x3e\n                        \x3cdiv class\x3d"history-card-description"\x3e'+
m+'\x3c/div\x3e\n                        \x3cdiv class\x3d"history-card-preview"\x3e\n                            \x3cdiv class\x3d"loading-spinner" data-id\x3d"'+k.id+'"\x3e\u52a0\u8f7d\u4e2d...\x3c/div\x3e\n                        \x3c/div\x3e\n                    \x3c/div\x3e\n                '}).join("");d={};e=$jscomp.makeIterator(b.data);for(f=e.next();!f.done;d={$jscomp$loop$prop$history$9$15:d.$jscomp$loop$prop$history$9$15},f=e.next())d.$jscomp$loop$prop$history$9$15=f.value,encodePlantUML(d.$jscomp$loop$prop$history$9$15.plantumlCode).then(function(k){return function(h){var m=
document.querySelector('.loading-spinner[data-id\x3d"'+k.$jscomp$loop$prop$history$9$15.id+'"]');m&&m.parentElement&&(m.parentElement.innerHTML='\x3cimg src\x3d"'+window.location.origin+"/plantuml/svg/"+h+'" alt\x3d"Preview" onerror\x3d"this.parentElement.innerHTML\x3d\'\x3cdiv style\x3d\\\'text-align:center;color:#999;\\\'\x3e\u9884\u89c8\u5931\u8d25\x3c/div\x3e\'"\x3e')}}(d)).catch(function(k){return function(h){console.error("Failed to encode PlantUML for favorite",k.$jscomp$loop$prop$history$9$15.id,
h);(h=document.querySelector('.loading-spinner[data-id\x3d"'+k.$jscomp$loop$prop$history$9$15.id+'"]'))&&h.parentElement&&(h.parentElement.innerHTML='\x3cdiv style\x3d"text-align:center;color:#999;"\x3e\u9884\u89c8\u5931\u8d25\x3c/div\x3e')}}(d))}else showToast(b.message||"\u52a0\u8f7d\u5931\u8d25","error");l.leaveTryBlock(0);break;case 2:g=l.enterCatchBlock(),showToast("\u7f51\u7edc\u9519\u8bef\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5","error"),console.error("Load favorites error:",g),l.jumpToEnd()}})}
function escapeHtml(a){if(!a)return"";var b=document.createElement("div");b.textContent=a;return b.innerHTML}
function encodePlantUML(a){var b,c,d;return $jscomp.asyncExecutePromiseGeneratorProgram(function(e){switch(e.nextAddress){case 1:if(!a)return e.return("");e.setCatchFinallyBlocks(2);return e.yield(fetch(window.location.origin+"/plantuml/coder",{method:"POST",headers:{"Content-Type":"text/plain"},body:a}),4);case 4:b=e.yieldResult;if(!b.ok){e.jumpTo(5);break}return e.yield(b.text(),6);case 6:return c=e.yieldResult,e.return(c);case 5:e.leaveTryBlock(3);break;case 2:d=e.enterCatchBlock(),console.error("Error encoding PlantUML:",
d);case 3:return e.return(encodeURIComponent(a))}})}function formatDate(a){a=new Date(a);var b=new Date-a;return 6E4>b?"\u521a\u521a":36E5>b?Math.floor(b/6E4)+"\u5206\u949f\u524d":864E5>b?Math.floor(b/36E5)+"\u5c0f\u65f6\u524d":6048E5>b?Math.floor(b/864E5)+"\u5929\u524d":a.toLocaleDateString("zh-CN")}var currentZoom=1,isDragging=!1,startX=0,startY=0,scrollLeft=0,scrollTop=0;
function openFullscreenPreview(){var a=document.getElementById("previewContainer").querySelector("img");if(a){var b=document.getElementById("fullscreenPreviewModal"),c=document.getElementById("fullscreenPreviewContainer");a=a.cloneNode(!0);a.style.transform="scale(1)";currentZoom=1;c.innerHTML="";c.appendChild(a);b.style.display="flex";setupImageDrag(c);document.addEventListener("keydown",handleEscKey)}else showToast("\u6ca1\u6709\u53ef\u9884\u89c8\u7684\u56fe\u7247","warning")}
function closeFullscreenPreview(){document.getElementById("fullscreenPreviewModal").style.display="none";currentZoom=1;document.removeEventListener("keydown",handleEscKey)}function handleEscKey(a){"Escape"===a.key&&closeFullscreenPreview()}
function zoomPreview(a){var b=document.getElementById("fullscreenPreviewContainer").querySelector("img");b&&("in"===a?currentZoom=Math.min(currentZoom+.2,5):"out"===a?currentZoom=Math.max(currentZoom-.2,.5):"reset"===a&&(currentZoom=1),b.style.transform="scale("+currentZoom+")",b.classList.toggle("zoomed",1<currentZoom))}
function setupImageDrag(a){a.addEventListener("mousedown",function(b){"IMG"===b.target.tagName&&1<currentZoom&&(isDragging=!0,startX=b.pageX-a.offsetLeft,startY=b.pageY-a.offsetTop,scrollLeft=a.scrollLeft,scrollTop=a.scrollTop,a.style.cursor="grabbing",b.preventDefault())});a.addEventListener("mouseleave",function(){isDragging=!1;a.style.cursor="default"});a.addEventListener("mouseup",function(){isDragging=!1;a.querySelector("img")&&1<currentZoom?a.style.cursor="grab":a.style.cursor="default"});a.addEventListener("mousemove",
function(b){if(isDragging){b.preventDefault();var c=2*(b.pageY-a.offsetTop-startY);a.scrollLeft=scrollLeft-2*(b.pageX-a.offsetLeft-startX);a.scrollTop=scrollTop-c}});a.addEventListener("wheel",function(b){if(b.ctrlKey||b.metaKey)b.preventDefault(),0>b.deltaY?zoomPreview("in"):zoomPreview("out")},{passive:!1})}var DONATE_WECHAT_ID="hualinyuezhao";
function openDonateModal(){var a=document.getElementById("donateModal"),b=document.getElementById("donateWechatId");b&&(b.textContent=DONATE_WECHAT_ID);a&&(a.style.display="block")}function closeDonateModal(){var a=document.getElementById("donateModal");a&&(a.style.display="none")}
function copyDonateWechatId(){var a=document.getElementById("donateWechatId").textContent;navigator.clipboard&&navigator.clipboard.writeText?navigator.clipboard.writeText(a).then(function(){showToast("\u5fae\u4fe1\u53f7\u5df2\u590d\u5236\u5230\u526a\u8d34\u677f","success")}).catch(function(b){console.error("\u590d\u5236\u5931\u8d25:",b);fallbackCopyText(a)}):fallbackCopyText(a)}
function fallbackCopyText(a){var b=document.createElement("textarea");b.value=a;b.style.position="fixed";b.style.top="0";b.style.left="0";b.style.width="2em";b.style.height="2em";b.style.padding="0";b.style.border="none";b.style.outline="none";b.style.boxShadow="none";b.style.background="transparent";document.body.appendChild(b);b.focus();b.select();try{document.execCommand("copy")?showToast("\u5fae\u4fe1\u53f7\u5df2\u590d\u5236\u5230\u526a\u8d34\u677f","success"):showToast("\u590d\u5236\u5931\u8d25\uff0c\u8bf7\u624b\u52a8\u590d\u5236",
"error")}catch(c){console.error("\u590d\u5236\u5931\u8d25:",c),showToast("\u590d\u5236\u5931\u8d25\uff0c\u8bf7\u624b\u52a8\u590d\u5236","error")}document.body.removeChild(b)}window.addEventListener("click",function(a){var b=document.getElementById("donateModal");a.target===b&&closeDonateModal()});
var $jscomp$destructuring$var17=function(){var a=function(){var c=[];return{suppressNextMessage:function(d,e){c.push({sender:d,condition:e})},isMessageSuppressed:function(d){for(var e=0;e<c.length;e++){var f=c[e];if(!f.sender||f.sender===d.sender)if(!f.condition||f.condition(d))return c.splice(e,1),!0}return!1}}}(),b=a.isMessageSuppressed;return{sendMessage:function(c){b(c)||(new BroadcastChannel("plantuml-server")).postMessage(c)},suppressNextMessage:a.suppressNextMessage,initAppCommunication:function(){(new BroadcastChannel("plantuml-server")).onmessage=
function(c){function d(l){var k,h,m,q,n,p;return $jscomp.asyncExecutePromiseGeneratorProgram(function(r){if(1==r.nextAddress)return document.appConfig.autoRefreshState="syncing",k=document.appData.encodedDiagram,h=document.appData.index,"url"!==l&&document.getElementById("url")&&setUrlValue(void 0,{encodedDiagram:k,index:h},{suppressEditorChangedMessage:!0}),r.yield(setDiagram(document.appConfig.diagramPreviewType,k,h),2);m=$jscomp.makeIterator(document.getElementsByClassName("diagram-link"));for(q=
m.next();!q.done;q=m.next())n=q.value,n.href=buildUrl(n.dataset.imgType,k,h);p=replaceUrl(window.location.href,k,h).url;history.replaceState(history.stat,document.title,p);document.appConfig.autoRefreshState="complete";r.jumpToEnd()})}var e,f,g;return $jscomp.asyncExecutePromiseGeneratorProgram(function(l){if(1==l.nextAddress){e=c.data.data;f=c.data.force||!1;if(e&&0!==Object.keys(e).length){var k={};"encodedDiagram"in e&&e.encodedDiagram!==document.appData.encodedDiagram&&(document.appData.encodedDiagram=
e.encodedDiagram,k.diagram=!0);"index"in e&&e.index!==document.appData.index&&(document.appData.index=e.index,k.index=!0);"numberOfDiagramPages"in e&&e.numberOfDiagramPages!==document.appData.numberOfDiagramPages&&(document.appData.numberOfDiagramPages=e.numberOfDiagramPages,k.numberOfDiagramPages=!0);"appConfig"in e&&e.appConfig!==document.appConfig&&(document.appConfig=e.appConfig,k.appConfig=!0)}else k={};g=k;return!0!==c.data.synchronize?l.jumpTo(2):f||g.diagram||g.index||g.appConfig?l.yield(d(c.data.sender),
3):l.jumpTo(3)}2!=l.nextAddress&&((f||g.numberOfDiagramPages)&&updatePaginator(),(f||g.numberOfDiagramPages||g.index)&&updatePaginatorSelection(),g.appConfig&&applyConfig());!0===c.data.reload&&window.location.reload();l.jumpToEnd()})}}}}(),sendMessage=$jscomp$destructuring$var17.sendMessage,suppressNextMessage=$jscomp$destructuring$var17.suppressNextMessage,initAppCommunication=$jscomp$destructuring$var17.initAppCommunication;
function makeRequest(a,b,c){c=void 0===c?{}:c;return PlantUmlLanguageFeatures.makeRequest(a,b,{data:void 0===c.data?null:c.data,headers:void 0===c.headers?{"Content-Type":"text/plain"}:c.headers,responseType:void 0===c.responseType?"text":c.responseType,baseUrl:void 0===c.baseUrl?"":c.baseUrl})}
var $jscomp$destructuring$var21=function(){var a={changeEventsEnabled:!0,autoRefreshState:"disabled",theme:void 0,diagramPreviewType:"png",editorWatcherTimeout:500,editorCreateOptions:{automaticLayout:!0,fixedOverflowWidgets:!0,minimap:{enabled:!1},scrollbar:{alwaysConsumeMouseWheel:!1},scrollBeyondLastLine:!1,tabSize:2,theme:"vs"}},b;document.appConfig=Object.assign({},null==(b=window.opener)?void 0:b.document.appConfig);0===Object.keys(document.appConfig).length&&(document.appConfig=JSON.parse(localStorage.getItem("document.appConfig"))||
a);return{applyConfig:function(){setTheme(document.appConfig.theme);var c;null==(c=document.editor)||c.updateOptions(document.appConfig.editorCreateOptions);var d;null==(d=document.settingsEditor)||d.updateOptions(document.appConfig.editorCreateOptions)},updateConfig:function(c){localStorage.setItem("document.appConfig",JSON.stringify(c));sendMessage({sender:"config",data:{appConfig:c},synchronize:!0})}}}(),applyConfig=$jscomp$destructuring$var21.applyConfig,updateConfig=$jscomp$destructuring$var21.updateConfig;
function removeChildren(a){a.replaceChildren?a.replaceChildren():a.innerHTML=""}function isVisible(a){return null!==a.offsetParent}function setVisibility(a,b,c){c=void 0===c?!1:c;b?(a.style.removeProperty("display"),c&&a.focus()):a.style.display="none"}var isMac=function(){var a,b,c;return((null==(a=navigator)?void 0:null==(b=a.userAgentData)?void 0:b.platform)||(null==(c=navigator)?void 0:c.platform)||"unknown").match("Mac")}();
function setTheme(a){document.documentElement.setAttribute("data-theme",a)}
function initTheme(){function a(d){"dark"===d&&"vs"===document.appConfig.editorCreateOptions.theme&&(document.appConfig.editorCreateOptions.theme="vs-dark");"light"===d&&"vs-dark"===document.appConfig.editorCreateOptions.theme&&(document.appConfig.editorCreateOptions.theme="vs")}var b=document.appConfig,c;(c=document.appConfig.theme)||(c=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":window.matchMedia("(prefers-color-scheme: light)").matches?"light":void 0);b.theme=c||"light";setTheme(document.appConfig.theme);
a(document.appConfig.theme);window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",function(d){d=d.matches?"dark":"light";document.appConfig.theme=d;a(d);updateConfig(document.appConfig)})}function resolvePath(a){return PlantUmlLanguageFeatures.absolutePath(a)}
function prepareUrl(a){a instanceof URL||(a=new URL(resolvePath(a)));var b=(new URL((document.querySelector("base")||{}).href||window.location.origin)).pathname;"/"===b.slice(-1)&&(b=b.slice(0,-1));b=a.pathname.startsWith(b)?a.pathname.slice(b.length):a.pathname;var c=/\/\w+(?:\/(\d+))?(?:\/([^/]+))?\/?$/gm.exec(b);return[a,b,{idx:c[1],encoded:c[2]}]}
function analyseUrl(a){var b=$jscomp.makeIterator(prepareUrl(a));a=b.next().value;b.next();b=b.next().value;return{index:b.idx,encodedDiagram:b.encoded||a.searchParams.get("url")}}
function replaceUrl(a,b,c){var d=$jscomp.makeIterator(prepareUrl(a));a=d.next().value;var e=d.next().value;d=d.next().value.encoded;var f=e.slice(1);f=f.slice(0,f.indexOf("/"));c&&0<=c&&(f+="/"+c);d&&(f+="/"+b);"/"===e.slice(-1)&&(f+="/");a.pathname=(new URL(resolvePath(f))).pathname;a.searchParams.get("url")&&a.searchParams.set("url",b);return{url:a,pathname:f}}function buildUrl(a,b,c){c&&0<=c&&(a+="/"+c);return a+("/"+b)};